<!-- /website/dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Portal - Markeb Media</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
  /* Base */
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Inter', sans-serif; background: #f8fafc; color: #1e293b; line-height: 1.6; }

  /* Sidebar */
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    width: 280px;
    height: 100vh;
    background: #fff;
    border-right: 1px solid #e2e8f0;
    padding: 32px 24px;
    z-index: 100;
    transform: translateX(0);
    transition: transform .3s ease;
    /* enable scrolling when content is taller than the viewport */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  .logo { margin-bottom: 48px; display: flex; align-items: center; }
  .logo img { height: 150px; width: auto; }

@media (max-width: 480px) {
  .logo img { height: 120px; }
}


  .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; margin-bottom: 8px; border-radius: 8px; color: #64748b; text-decoration: none; font-weight: 500; transition: all .2s ease; cursor: pointer; }
  .nav-item:hover, .nav-item.active { background: #f1f5f9; color: #0f172a; }
  .nav-item.active { background: #3b82f6; color: #fff; }
  .nav-icon { width: 20px; height: 20px; font-size: 16px; display: flex; align-items: center; justify-content: center; line-height: 1; }

  .mobile-toggle { display: none; position: fixed; top: 20px; left: 20px; z-index: 101; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,.1); }
  .mobile-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,.5); z-index: 99; }

  .main-content { margin-left: 280px; min-height: 100vh; width: calc(100vw - 280px); box-sizing: border-box; }

  .header { background: #fff; border-bottom: 1px solid #e2e8f0; padding: 24px 32px; display: flex; justify-content: space-between; align-items: center; }
  .header-left { flex: 1; }

  /* Responsive headings */
  .page-title { font-size: clamp(20px, 3.5vw, 28px); font-weight: 600; color: #0f172a; margin-bottom: 4px; }
  .page-subtitle { color: #64748b; font-size: 16px; }

  .header-right { display: flex; align-items: center; gap: 16px; }
  .user-info { display: flex; align-items: center; gap: 12px; padding: 8px 16px; background: #f8fafc; border-radius: 8px; }
  .user-avatar { width: 40px; height: 40px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 600; }
  .user-details h4 { font-size: 14px; font-weight: 600; color: #0f172a; }
  .user-details p { font-size: 12px; color: #64748b; }

  .btn { padding: 12px 20px; border-radius: 8px; font-weight: 500; text-decoration: none; border: none; cursor: pointer; transition: all .2s ease; font-size: 14px; display: inline-flex; align-items: center; gap: 8px; }
  .btn-primary { background: #3b82f6; color: #fff; }
  .btn-primary:hover { background: #2563eb; }

  /* Content area & sections */
  :root { --footer-h: 80px; }
  .content-area { padding: 32px; padding-bottom: calc(var(--footer-h) + env(safe-area-inset-bottom, 0px)); }
  .section { display: none; }
  .section.active { display: block; }

  /* Metrics */
  .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 24px; margin-bottom: 32px; }
  .metric-card { background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 24px; transition: all .2s ease; }
  .metric-card:hover { border-color: #cbd5e1; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,.05); }
  .metric-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
  .metric-icon { width: 48px; height: 48px; background: #eff6ff; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
  .metric-value { font-size: 32px; font-weight: 700; color: #0f172a; margin-bottom: 4px; }
  .metric-label { color: #64748b; font-size: 14px; font-weight: 500; }

  /* Cards & layout */
  .content-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 32px; }
  .card { background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; }
  .card-header { padding: 24px 24px 0; border-bottom: 1px solid #f1f5f9; margin-bottom: 24px; }
  .card-title { font-size: clamp(16px, 2.6vw, 18px); font-weight: 600; color: #0f172a; margin-bottom: 8px; }
  .card-subtitle { color: #64748b; font-size: 14px; }
  .card-content { padding: 0 24px 24px; }

  .activity-item { display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px solid #f1f5f9; }
  .activity-item:last-child { border-bottom: none; }
  .activity-icon { width: 40px; height: 40px; background: #f8fafc; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
  .activity-title { font-weight: 500; color: #0f172a; margin-bottom: 4px; }
  .activity-time { font-size: 13px; color: #64748b; }

  .action-grid { display: grid; gap: 12px; }
  .action-item { display: flex; align-items: center; gap: 12px; padding: 16px; background: #f8fafc; border-radius: 8px; text-decoration: none; color: #0f172a; transition: all .2s ease; cursor: pointer; }
  .action-item:hover { background: #f1f5f9; }
  .action-icon { width: 36px; height: 36px; background: #fff; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 16px; }

  /* Booking */
  .booking-container { background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; }
  .booking-header { padding: 24px; border-bottom: 1px solid #e2e8f0; background: #f8fafc; }
  .booking-title { font-size: 24px; font-weight: 700; color: #0f172a; margin-bottom: 8px; }
  .booking-description { color: #64748b; line-height: 1.6; }
  .booking-iframe-container { padding: 0; background: #fff; }
  .booking-iframe {
    width: 100%;
    height: min(80dvh, 800px); /* adaptive to mobile URL bar, keeps max */
    border: none;
    display: block;
  }

  /* Tracking widgets */
  .warning-message{background:linear-gradient(135deg,#FEF3C7 0%,#FCD34D 100%);border:2px solid #F59E0B;border-radius:16px;padding:20px;color:#92400E;font-weight:600;text-align:center}
  .error-message{background:linear-gradient(135deg,#FEE2E2 0%,#FECACA 100%);border:2px solid #EF4444;border-radius:16px;padding:20px;color:#991B1B;font-weight:600;text-align:center}
  .spinner{margin:30px auto;width:50px;height:50px;border:4px solid #E5E7EB;border-top:4px solid #3b82f6;border-radius:50%;animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .progress-container{display:flex;align-items:center;justify-content:space-between;max-width:100%;padding:30px 10px;margin:30px auto;position:relative}
  .progress-container::before{content:'';position:absolute;top:50%;left:10%;right:10%;height:4px;background:#E5E7EB;z-index:0;border-radius:2px;transform:translateY(-50%)}
  .progress-step{z-index:1;flex:1;text-align:center;position:relative}
  .progress-step .icon{width:50px;height:50px;border-radius:50%;background:#E5E7EB;margin:0 auto;font-size:1.4em;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold;position:relative;z-index:1;transition:all .3s ease;border:3px solid #FFFFFF;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
  .progress-step.active .icon{background:linear-gradient(135deg,#3b82f6,#60a5fa);transform:scale(1.1);box-shadow:0 6px 20px rgba(59,130,246,.35)}
  .progress-step .label{margin-top:12px;font-size:.9em;color:#6B7280;font-weight:500}
  .progress-step.active .label{color:#1F2E3C;font-weight:700}
  .progress-line{position:absolute;top:50%;left:10%;height:4px;background:linear-gradient(90deg,#3b82f6,#60a5fa);border-radius:2px;z-index:0;transition:width .8s ease-in-out;transform:translateY(-50%);box-shadow:0 2px 8px rgba(59,130,246,.25)}
  .info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin:25px 0}
  .info-item{background:linear-gradient(135deg,#F8FAFC 0%,#FFFFFF 100%);padding:20px;border-radius:12px;border:1px solid #E5E7EB;transition:all .3s ease}
  .info-item:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.08)}
  .deadline-alert{background:linear-gradient(135deg,#E0E7FF 0%,#C7D2FE 100%);border:2px solid #6366F1;border-radius:16px;padding:20px;margin:20px 0;text-align:center;color:#3730A3;font-weight:600}
  .delivery-link{background:linear-gradient(135deg,#D1FAE5 0%,#A7F3D0 100%);border:2px solid #10B981;border-radius:16px;padding:20px;margin:20px 0;text-align:center}

  /* Amend file upload */
  .file-upload-area{border:2px dashed #E5E7EB;border-radius:12px;padding:20px;text-align:center;background:#FAFAFA;transition:all .3s ease;cursor:pointer}
  .file-upload-area:hover{border-color:#3b82f6;background:rgba(59,130,246,.03)}
  .file-upload-area.dragover{border-color:#3b82f6;background:rgba(59,130,246,.08)}
  .file-preview{margin-top:16px;display:none}
  .file-item{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:#fff;border:2px solid #E5E7EB;border-radius:8px;margin-bottom:8px}
  .file-remove{background:#EF4444;color:#fff;border:none;border-radius:6px;padding:6px 10px;font-size:.8em;cursor:pointer}
  .upload-progress{display:none;margin-top:12px;padding:12px;background:#eff6ff;border:1px solid #bfdbfe;border-radius:8px;text-align:center}
  .progress-bar{width:100%;height:6px;background:#E5E7EB;border-radius:3px;margin:10px 0;overflow:hidden}
  .progress-fill{height:100%;background:linear-gradient(90deg,#3b82f6,#60a5fa);width:0%}

  /* Footer */
.page-footer{position:fixed;bottom:0;left:280px;right:0;background:#fff;border-top:1px solid #e2e8f0;padding:16px 32px;z-index:50;display:flex;justify-content:space-between;align-items:center;padding-bottom:16px;margin-bottom:0;}
.footer-buttons{display:flex;gap:12px;}
.footer-btn{padding:10px 20px;border-radius:8px;font-weight:500;text-decoration:none;border:1px solid #e2e8f0;cursor:pointer;transition:all .2s ease;font-size:14px;background:#fff;color:#64748b;}
.footer-btn:hover{background:#f8fafc;border-color:#cbd5e1;color:#0f172a;}
.footer-copyright{font-size:12px;color:#64748b;}

  /* ===== DRONE ANIMATION ===== */
  .drone-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
    overflow: hidden;
  }

  .drone {
    position: absolute;
    width: 60px;
    height: 60px;
    animation: flyDrone 45s linear infinite;
    filter: drop-shadow(0 4px 8px rgba(59, 130, 246, 0.3));
  }

  @keyframes flyDrone {
    0% {
      top: -10%;
      left: -10%;
      transform: rotate(0deg) scale(0.8);
    }
    25% {
      top: 20%;
      left: 80%;
      transform: rotate(90deg) scale(1);
    }
    50% {
      top: 70%;
      left: 90%;
      transform: rotate(180deg) scale(1.1);
    }
    75% {
      top: 80%;
      left: 10%;
      transform: rotate(270deg) scale(0.9);
    }
    100% {
      top: -10%;
      left: -10%;
      transform: rotate(360deg) scale(0.8);
    }
  }

  .drone svg {
    width: 100%;
    height: 100%;
  }

  /* Subtle background gradient for depth */
  .main-content::before {
    content: '';
    position: fixed;
    top: 0;
    left: 280px;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 30% 20%, rgba(59, 130, 246, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(139, 92, 246, 0.02) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  /* ===== BRANDING SESSIONS PROMO ===== */
  .branding-promo {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border-radius: 16px;
    padding: 32px;
    margin-top: 32px;
    margin-bottom: 0;
    color: #fff;
    position: relative;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(16, 185, 129, 0.3);
    animation: fadeInUp 0.6s ease-out;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .branding-promo::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -20%;
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
    border-radius: 50%;
    animation: pulse 4s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% {
      transform: scale(1);
      opacity: 0.5;
    }
    50% {
      transform: scale(1.1);
      opacity: 0.8;
    }
  }

  .branding-promo-content {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    gap: 0;
    align-items: flex-start;
  }

  .branding-promo-text h2 {
    font-size: clamp(24px, 4vw, 32px);
    font-weight: 700;
    margin-bottom: 12px;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    font-family: 'Inter', sans-serif;
  }

  .branding-promo-text p {
    font-size: 16px;
    line-height: 1.7;
    margin-bottom: 20px;
    opacity: 0.95;
    font-family: 'Inter', sans-serif;
    font-weight: 400;
  }

  .branding-promo-features {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 24px;
  }

  .feature-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    border: 1px solid rgba(255, 255, 255, 0.3);
    font-family: 'Inter', sans-serif;
  }

  .branding-promo-cta {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .btn-branding-primary {
    background: #fff;
    color: #059669;
    padding: 14px 28px;
    border-radius: 10px;
    font-weight: 700;
    text-decoration: none;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-family: 'Inter', sans-serif;
  }

  .btn-branding-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    background: #f0fdf4;
  }

  .btn-branding-secondary {
    background: transparent;
    color: #fff;
    padding: 14px 28px;
    border-radius: 10px;
    font-weight: 600;
    text-decoration: none;
    border: 2px solid rgba(255, 255, 255, 0.5);
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-family: 'Inter', sans-serif;
  }

  .btn-branding-secondary:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: #fff;
  }

  /* Responsive adjustments */
  @media (max-width: 900px) {
    .branding-promo-content {
      flex-direction: column;
    }
    
    .branding-promo-cta {
      justify-content: center;
    }
  }

  /* Make sure content is above background effects */
  .content-area > * {
    position: relative;
    z-index: 2;
  }

  /* Touch-friendly tap targets */
  @media (pointer: coarse) {
    .nav-item, .action-item, .footer-btn, .btn { padding: 14px 20px; }
    .nav-item { gap: 14px; }
  }

  /* Tablet refinement */
  @media (max-width: 900px) {
    .content-grid { grid-template-columns: 1fr; }
  }

  /* Gallery protection on tiny screens */
  .gallery-image { aspect-ratio: 16 / 9; object-fit: cover; }

  /* Breakpoints */
  @media (max-width: 1024px) {
    .sidebar { transform: translateX(-100%); }
    .sidebar.open { transform: translateX(0); }
    .mobile-toggle { display: block; }
    .mobile-overlay.active { display: block; }
    .main-content { margin-left: 0; width: 100%; }
    .content-grid { grid-template-columns: 1fr; }
    /* remove the extra left padding so header stays aligned */
    .header { padding: 24px 32px; }
    .booking-iframe { height: 600px; }
    .page-footer { left: 0; }
    .main-content::before { left: 0; }
  }

  @media (max-width: 768px) {
    .header {
      flex-direction: column;
      align-items: center;
      gap: 16px;
      text-align: center;
      padding: 16px 20px; /* removed padding-left: 80px */
    }

    .header-left  { order: 2; }
    .header-right { order: 1; }

    .header-left,
    .header-right {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    .page-title { font-size: clamp(20px, 5.5vw, 24px); }
    .content-area { padding: 20px; padding-bottom: calc(var(--footer-h) + env(safe-area-inset-bottom, 0px)); }
    .metrics-grid { grid-template-columns: repeat(2, 1fr); gap: 16px; }
    .metric-card { padding: 20px; }
    .metric-value { font-size: 28px; }
    .metric-label { font-size: 12px; }
    .card { margin-bottom: 20px; }
    .card-header { padding: 20px 20px 0; margin-bottom: 20px; }
    .card-content { padding: 0 20px 20px; }
    .action-item { padding: 12px; }
    .action-icon { width: 32px; height: 32px; font-size: 14px; }
    .booking-iframe { height: 500px; }
  }

  @media (max-width: 480px) {
    .metrics-grid { grid-template-columns: 1fr; }
    .metric-card { padding: 16px; text-align: center; }
    .content-area { 
      padding: 16px;
      padding-bottom: calc(var(--footer-h) + env(safe-area-inset-bottom, 0px));
    }
    .card-header { padding: 16px 16px 0; margin-bottom: 16px; }
    .card-content { padding: 0 16px 16px; }
    .activity-item { padding: 12px 0; }
    .activity-icon { width: 36px; height: 36px; }
    .page-title { font-size: 20px; }
    .page-subtitle { font-size: 14px; }

    /* CHANGED: center header on phones (removed padding-left: 70px) */
    .header {
      flex-direction: column;
      align-items: center;
      gap: 12px;
      text-align: center;
      padding: 12px 16px;
    }

    /* NEW: keep avatar/name/email ABOVE welcome; center both blocks */
    .header-left  { order: 2; }
    .header-right { order: 1; }
    .header-left,
    .header-right {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    .booking-iframe { height: 400px; }

    /* smaller copyright */
    .footer-copyright { font-size: 12px; }

    /* footer stays fixed but taller */
    :root { --footer-h: 120px; }   /* increased reserved space */

    .page-footer {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      flex-direction: column;
      gap: 8px;
      text-align: center;
      padding: 12px 16px calc(12px + env(safe-area-inset-bottom, 0px));
    }

    .footer-buttons { justify-content: center; }

    .branding-promo {
      padding: 24px;
    }
    
    .branding-promo-text h2 {
      font-size: 22px;
    }
    
    .branding-promo-text p {
      font-size: 14px;
    }
    
    .feature-badge {
      font-size: 12px;
      padding: 6px 12px;
    }
    
    .drone {
      width: 40px;
      height: 40px;
    }

    }
  
/* ===== CALENDAR VIEW STYLES ===== */
.calendar-container {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  border-radius: 20px;
  padding: 40px;
  margin-bottom: 32px;
  color: #fff;
  box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
}

.calendar-header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 32px;
  flex-wrap: wrap;
  gap: 20px;
}

.calendar-title-section h2 {
  font-size: clamp(28px, 4vw, 36px);
  font-weight: 700;
  margin-bottom: 8px;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.calendar-title-section p {
  font-size: 16px;
  opacity: 0.9;
}

.calendar-controls {
  display: flex;
  align-items: center;
  gap: 16px;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(10px);
  padding: 12px 20px;
  border-radius: 12px;
}

.calendar-nav-btn {
  background: rgba(255, 255, 255, 0.9);
  color: #3b82f6;
  border: 2px solid rgba(255, 255, 255, 0.3);
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all .2s ease;
}

.calendar-nav-btn:hover {
  background: #fff;
  transform: translateY(-1px);
}

.calendar-current-month {
  color: #fff;
  font-size: 18px;
  font-weight: 700;
  min-width: 200px;
  text-align: center;
}

.calendar-view {
  background: #fff;
  border-radius: 16px;
  padding: 24px;
  margin-top: 24px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.calendar-weekdays {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
  margin-bottom: 16px;
  padding-bottom: 16px;
  border-bottom: 2px solid #e2e8f0;
}

.calendar-weekdays > div {
  text-align: center;
  font-weight: 700;
  color: #64748b;
  font-size: 14px;
  text-transform: uppercase;
}

.calendar-days-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
}

.calendar-day {
  aspect-ratio: 1;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  padding: 8px;
  cursor: pointer;
  transition: all .2s ease;
  position: relative;
  background: #ffffff;
  display: flex;
  flex-direction: column;
  min-height: 100px;
}

.calendar-day:hover {
  border-color: #667eea;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

.calendar-day.today {
  border-color: #3b82f6;
  background: #ffffff;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}

.calendar-day.other-month {
  opacity: 0.3;
  pointer-events: none;
}

.calendar-day.empty {
  background: transparent;
  border: none;
  cursor: default;
  pointer-events: none;
}

.calendar-day.has-content {
  border-color: #10b981;
  background: #f0fdf4;
}

.calendar-day.has-review {
  border-color: #f59e0b;
  background: #fffbeb;
  animation: pulse-day 2s ease-in-out infinite;
}

@keyframes pulse-day {
  0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
  50% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }
}

.day-number {
  font-weight: 700;
  color: #1e293b;
  font-size: 16px;
  margin-bottom: 4px;
}

.day-content-count {
  font-size: 12px;
  color: #16a34a;
  font-weight: 500;
  margin-top: 4px;
}

.calendar-day-number {
  font-weight: 700;
  color: #1e293b;
  font-size: 16px;
  margin-bottom: 4px;
}

.calendar-day-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
  overflow: hidden;
}

.calendar-content-dot {
  width: 100%;
  height: 24px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all .2s ease;
}

.calendar-content-dot:hover {
  transform: scale(1.05);
}

.calendar-content-dot.scheduled { background: #dbeafe; color: #1e40af; }
.calendar-content-dot.drafting { background: #fef3c7; color: #92400e; }
.calendar-content-dot.in-progress { background: #fef3c7; color: #92400e; }
.calendar-content-dot.ready-for-review { 
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); 
  color: #92400e;
  border: 2px solid #f59e0b;
}
.calendar-content-dot.approved { background: #d1fae5; color: #065f46; }
.calendar-content-dot.published { background: #e0e7ff; color: #3730a3; }

.calendar-content-more {
  font-size: 11px;
  color: #64748b;
  text-align: center;
  margin-top: 4px;
  font-weight: 600;
}

.calendar-empty-state {
  text-align: center;
  padding: 80px 40px;
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border: 2px dashed #cbd5e1;
  border-radius: 16px;
  margin-top: 0;
}

.calendar-empty-state h3 {
  font-size: 24px;
  font-weight: 700;
  color: #0f172a;
  margin-bottom: 12px;
}

.calendar-empty-state p {
  color: #64748b;
  margin-bottom: 8px;
  line-height: 1.6;
  font-size: 15px;
}

.social-media-promo {
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  border-radius: 16px;
  padding: 32px;
  margin-top: 32px;
  color: #0f172a;
  position: relative;
  overflow: hidden;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
  border: 2px solid #e2e8f0;
}

.social-media-promo::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -20%;
  width: 400px;
  height: 400px;
  background: radial-gradient(circle, rgba(59, 130, 246, 0.05) 0%, transparent 70%);
  border-radius: 50%;
}

.social-media-promo-content { 
  position: relative; 
  z-index: 1;
  text-align: center;
}

.social-media-promo h2 { 
  font-size: clamp(24px, 4vw, 32px); 
  font-weight: 700; 
  margin-bottom: 12px;
  color: #0f172a;
}

.social-media-promo p { 
  font-size: 16px; 
  line-height: 1.7; 
  margin-bottom: 20px; 
  opacity: 0.8;
  color: #475569;
}

.social-media-features {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-bottom: 24px;
  justify-content: center;
}

.sm-feature-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: #fff;
  backdrop-filter: blur(10px);
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
  border: 2px solid #e2e8f0;
  color: #475569;
}

.btn-sm-primary {
  background: #3b82f6;
  color: #fff;
  padding: 14px 28px;
  border-radius: 10px;
  font-weight: 700;
  text-decoration: none;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2);
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-sm-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
  background: #2563eb;
}

/* ===== CONTENT MODAL ===== */
.content-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(4px);
  z-index: 9999;
  padding: 20px;
  overflow-y: auto;
  align-items: center;
  justify-content: center;
}

.content-modal.active {
  display: flex;
  align-items: center;
  justify-content: center;
}

.content-modal-dialog {
  background: #fff;
  border-radius: 16px;
  max-width: 800px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: modalSlideIn 0.3s ease-out;
  position: relative;
  z-index: 10000;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.content-modal-header {
  padding: 24px;
  border-bottom: 2px solid #e2e8f0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: #fff;
  border-radius: 16px 16px 0 0;
}

.content-modal-header h3 {
  margin: 0;
  font-size: 24px;
  font-weight: 700;
}

.modal-close {
  background: rgba(255, 255, 255, 0.2);
  border: 2px solid rgba(255, 255, 255, 0.3);
  color: #fff;
  font-size: 28px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all .2s ease;
  line-height: 1;
}

.modal-close:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: rotate(90deg);
}

.content-modal-body {
  padding: 24px;
}

.modal-content-item {
  background: #ffffff;
  border: 2px solid #e2e8f0;
  border-left: 6px solid;
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 20px;
  transition: all .2s ease;
}

.modal-content-item:hover {
  transform: translateX(4px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.modal-content-item.status-scheduled { border-left-color: #3b82f6; }
.modal-content-item.status-drafting { border-left-color: #f59e0b; }
.modal-content-item.status-in-progress { border-left-color: #f59e0b; }
.modal-content-item.status-ready-for-review { border-left-color: #f59e0b; }
.modal-content-item.status-approved { border-left-color: #10b981; }
.modal-content-item.status-published { border-left-color: #6366f1; }

.modal-item-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  flex-wrap: wrap;
  gap: 12px;
}

.modal-platform {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: #fff;
  border: 2px solid #e2e8f0;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 700;
  color: #475569;
}

.modal-content-item h3 {
  font-size: 20px;
  font-weight: 700;
  color: #0f172a;
  margin-bottom: 12px;
}

.modal-caption {
  font-size: 15px;
  color: #475569;
  line-height: 1.6;
  margin-bottom: 16px;
  padding: 16px;
  background: #fff;
  border-radius: 8px;
  border-left: 4px solid #667eea;
}

.modal-status {
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.modal-notes {
  margin-top: 16px;
  padding: 16px;
  background: #fef3c7;
  border-left: 4px solid #f59e0b;
  border-radius: 8px;
  font-size: 14px;
  color: #92400e;
}

.modal-client-notes {
  margin-top: 16px;
  padding: 16px;
  background: #e0e7ff;
  border-left: 4px solid #6366f1;
  border-radius: 8px;
  font-size: 14px;
  color: #3730a3;
}

.media-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: #fff;
  text-decoration: none;
  border-radius: 10px;
  font-weight: 700;
  margin: 16px 0;
  transition: all .2s ease;
}

.media-link:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
}

.calendar-status-badge {
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-scheduled { 
  background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
  color: #1e40af;
  border: 2px solid #3b82f6;
}

.status-drafting,
.status-in-progress { 
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  color: #92400e;
  border: 2px solid #f59e0b;
}

.status-ready-for-review { 
  background: #ffffff;
  color: #5b21b6;
  border: 2px solid #8b5cf6;
  animation: pulse-glow 2s ease-in-out infinite;
}

@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.4); }
  50% { box-shadow: 0 0 0 6px rgba(139, 92, 246, 0); }
}

.status-approved { 
  background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
  color: #065f46;
  border: 2px solid #10b981;
}

.status-published { 
  background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
  color: #3730a3;
  border: 2px solid #6366f1;
}

.status-declined { 
  background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
  color: #991b1b;
  border: 2px solid #ef4444;
}

.modal-actions,
.client-actions {
  margin-top: 20px;
  padding: 20px;
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border: 3px solid #f59e0b;
  border-radius: 12px;
}

.modal-actions h4,
.client-actions-header {
  font-size: 16px;
  font-weight: 700;
  color: #92400e;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.modal-action-buttons,
.client-actions-buttons {
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.modal-notes-section,
.client-notes-section {
  margin-top: 12px;
}

.modal-notes-section label,
.client-notes-label {
  font-size: 13px;
  font-weight: 600;
  color: #92400e;
  margin-bottom: 6px;
  display: block;
}

.modal-notes-section textarea,
.client-notes-textarea {
  width: 100%;
  padding: 10px 12px;
  border: 2px solid #f59e0b;
  border-radius: 6px;
  font-size: 13px;
  font-family: 'Inter', sans-serif;
  resize: vertical;
  min-height: 80px;
  transition: border-color .2s ease;
}

.modal-notes-section textarea:focus,
.client-notes-textarea:focus {
  outline: none;
  border-color: #d97706;
  box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
}

.client-notes-submit {
  margin-top: 8px;
}

.action-feedback {
  margin-top: 12px;
  padding: 10px 12px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
}

.action-feedback.success {
  background: #d1fae5;
  color: #065f46;
  border: 1px solid #10b981;
}

.action-feedback.error {
  background: #fee2e2;
  color: #991b1b;
  border: 1px solid #ef4444;
}

.btn,
.btn-success,
.btn-danger,
.btn-secondary {
  padding: 12px 20px;
  border-radius: 8px;
  font-weight: 700;
  text-decoration: none;
  border: none;
  cursor: pointer;
  transition: all .2s ease;
  font-size: 14px;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  color: #fff;
  flex: 1;
  min-width: 140px;
  justify-content: center;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.btn-success {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}

.btn-success:hover {
  background: linear-gradient(135deg, #059669 0%, #047857 100%);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
}

.btn-danger {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
}

.btn-danger:hover {
  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
}

.btn-secondary {
  background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
}

.btn-secondary:hover {
  background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
}

  /* ===== CALENDAR RESPONSIVE STYLES ===== */
@media (max-width: 480px) {
  .calendar-container {
    padding: 12px;
    margin-bottom: 16px;
  }

  .calendar-header-content {
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 12px;
  }

  .calendar-title-section {
    text-align: center;
    width: 100%;
  }

  .calendar-title-section h2 {
    font-size: 18px;
  }

  .calendar-title-section p {
    font-size: 12px;
  }

  .calendar-controls {
    padding: 8px 12px;
    gap: 8px;
    justify-content: center;
  }

  .calendar-nav-btn {
    padding: 5px 8px;
    font-size: 11px;
  }

  .calendar-current-month {
    min-width: 100px;
    font-size: 13px;
  }

  .calendar-view {
    padding: 8px;
  }

  .calendar-weekdays {
    gap: 1px;
    margin-bottom: 6px;
    padding-bottom: 6px;
  }

  .calendar-weekdays > div {
    font-size: 10px;
    padding: 2px 0;
  }

  .calendar-days-grid {
    gap: 1px;
  }

  .calendar-day {
    min-height: 40px;
    max-height: 40px;
    aspect-ratio: 1;
    padding: 1px;
    border-radius: 4px;
    border-width: 1px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .day-number,
  .calendar-day-number {
    font-size: 10px;
    margin-bottom: 0;
    line-height: 1;
  }

  .day-content-count {
    font-size: 7px;
    margin-top: 1px;
    line-height: 1;
  }

  .content-modal {
    padding: 0;
    align-items: flex-start;
    overflow-y: auto;
  }

  .content-modal-dialog {
    max-width: 100%;
    max-height: calc(100vh - var(--footer-h) - 20px);
    border-radius: 0;
    margin: 0;
    margin-bottom: calc(var(--footer-h) + 10px);
  }

  .content-modal-header {
    padding: 12px;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .content-modal-header h3 {
    font-size: 16px;
  }

  .modal-close {
    width: 32px;
    height: 32px;
    font-size: 20px;
  }

  .content-modal-body {
    padding: 12px;
  }

  .modal-content-item {
    padding: 12px;
    margin-bottom: 12px;
  }

  .modal-content-item h3 {
    font-size: 16px;
  }

  .modal-item-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }

  .modal-platform {
    font-size: 12px;
    padding: 4px 10px;
  }

  .modal-caption {
    font-size: 13px;
    padding: 10px;
  }

  .modal-actions,
  .client-actions {
    padding: 12px;
  }

  .modal-actions h4 {
    font-size: 14px;
    margin-bottom: 10px;
  }

  .modal-action-buttons,
  .client-actions-buttons {
    gap: 8px;
  }

  .btn,
  .btn-success,
  .btn-danger,
  .btn-secondary {
    padding: 10px 16px;
    font-size: 13px;
  }

  textarea {
    min-height: 70px;
    font-size: 13px;
    padding: 10px;
  }

  .media-link {
    padding: 10px 16px;
    font-size: 13px;
  }
}
</style>

</head>
<body>
  <!-- DRONE ANIMATION -->
  <div class="drone-container">
    <div class="drone">
      <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
        <!-- Drone body -->
        <rect x="24" y="28" width="16" height="8" rx="2" fill="#3B82F6"/>
        <!-- Camera -->
        <circle cx="32" cy="36" r="3" fill="#1E293B"/>
        <!-- Propeller arms -->
        <line x1="28" y1="30" x2="16" y2="18" stroke="#64748B" stroke-width="2" stroke-linecap="round"/>
        <line x1="36" y1="30" x2="48" y2="18" stroke="#64748B" stroke-width="2" stroke-linecap="round"/>
        <line x1="28" y1="34" x2="16" y2="46" stroke="#64748B" stroke-width="2" stroke-linecap="round"/>
        <line x1="36" y1="34" x2="48" y2="46" stroke="#64748B" stroke-width="2" stroke-linecap="round"/>
        <!-- Propellers (spinning effect) -->
        <g opacity="0.7">
          <circle cx="16" cy="18" r="6" fill="#60A5FA"/>
          <circle cx="48" cy="18" r="6" fill="#60A5FA"/>
          <circle cx="16" cy="46" r="6" fill="#60A5FA"/>
          <circle cx="48" cy="46" r="6" fill="#60A5FA"/>
        </g>
        <!-- Propeller centers -->
        <circle cx="16" cy="18" r="2" fill="#1E293B"/>
        <circle cx="48" cy="18" r="2" fill="#1E293B"/>
        <circle cx="16" cy="46" r="2" fill="#1E293B"/>
        <circle cx="48" cy="46" r="2" fill="#1E293B"/>
      </svg>
    </div>
  </div>

  <div class="mobile-toggle" onclick="toggleSidebar()">
    <div style="width: 20px; height: 20px; display: flex; flex-direction: column; justify-content: space-between;">
      <div style="width: 100%; height: 2px; background: #64748b;"></div>
      <div style="width: 100%; height: 2px; background: #64748b;"></div>
      <div style="width: 100%; height: 2px; background: #64748b;"></div>
    </div>
  </div>
  <div class="mobile-overlay" onclick="closeSidebar()"></div>

  <div class="sidebar">
    <div class="logo">
      <img src="../public/images/Markeb Media Logo (2).PNG" alt="Markeb Media" />
    </div>
    <nav>
      <div class="nav-item active" onclick="showSection('dashboard')"><div class="nav-icon">‚óè</div>Dashboard</div>
      <div class="nav-item" onclick="showSection('booking')"><div class="nav-icon">+</div>Book Shoot</div>
      <div class="nav-item" onclick="showSection('gallery')"><div class="nav-icon">‚ñ°</div>Gallery</div>
      <div class="nav-item" onclick="openCopyryta()"><div class="nav-icon">‚óá</div>CopyRyta AI</div>
      <div class="nav-item" onclick="showSection('tracking')"><div class="nav-icon">‚ñ≤</div>Content Tracking</div>
      <div class="nav-item" onclick="showSection('calendar')"><div class="nav-icon">‚ñ°</div>Content Calendar</div>
      <div class="nav-item" onclick="showSection('amend')"><div class="nav-icon">‚ñ≥</div>Request Amendment</div>
      <div class="nav-item" onclick="showSection('settings')"><div class="nav-icon">‚óã</div>Settings</div>
      <div class="nav-item" onclick="contactSupport()"><div class="nav-icon">@</div>Support</div>
      <div class="nav-item" onclick="logoutAll()" style="margin-top: 40px; color: #ef4444;"><div class="nav-icon">‚Üê</div>Logout</div>
    </nav>
  </div>

  <div class="main-content">
    <div class="header">
      <div class="header-left">
        <h1 class="page-title" id="pageTitle">Welcome back</h1>
        <p class="page-subtitle" id="pageSubtitle">Here's what's happening with your projects</p>
      </div>
      <div class="header-right">
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">M</div>
          <div class="user-details">
            <h4 id="userName">Loading...</h4>
            <p id="userEmail">Loading...</p>
          </div>
        </div>
      </div>
    </div>

    <div class="content-area">
      <!-- DASHBOARD -->
      <div id="dashboard" class="section active">
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-header"><div class="metric-icon">‚ñ†</div></div>
            <div class="metric-value" id="totalBookings">0</div>
            <div class="metric-label">Total Bookings</div>
          </div>
          <div class="metric-card">
            <div class="metric-header"><div class="metric-icon">¬£</div></div>
            <div class="metric-value" id="totalSpending">¬£0</div>
            <div class="metric-label">Total Investment</div>
          </div>
          <div class="metric-card">
            <div class="metric-header"><div class="metric-icon">‚úì</div></div>
            <div class="metric-value" id="completedProjects">0</div>
            <div class="metric-label">Completed Projects</div>
          </div>
          <div class="metric-card">
            <div class="metric-header"><div class="metric-icon">#</div></div>
            <div class="metric-value" id="memberSince">‚Äî</div>
            <div class="metric-label">Member Since</div>
          </div>
        </div>

        <div class="content-grid">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Recent Activity</h2>
              <p class="card-subtitle">Your latest interactions and updates</p>
            </div>
            <div class="card-content">
              <div id="activityList"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Quick Actions</h2>
              <p class="card-subtitle">Common tasks and shortcuts</p>
            </div>
            <div class="card-content">
              <div class="action-grid">
                <div class="action-item" onclick="showSection('booking')">
                  <div class="action-icon">+</div>
                  <div>
                    <div style="font-weight: 500;">Book New Shoot</div>
                    <div style="font-size: 12px; color: #64748b;">Schedule photos and videos</div>
                  </div>
                </div>
                <div class="action-item" onclick="showSection('tracking')">
                  <div class="action-icon">‚ñ≤</div>
                  <div>
                    <div style="font-weight: 500;">Track Content</div>
                    <div style="font-size: 12px; color: #64748b;">Monitor content progress</div>
                  </div>
                </div>
                <div class="action-item" onclick="openCopyryta()">
                  <div class="action-icon">‚óá</div>
                  <div>
                    <div style="font-weight: 500;">CopyRyta AI</div>
                    <div style="font-size: 12px; color: #64748b;">AI copywriting tool</div>
                  </div>
                </div>
                <div class="action-item" onclick="showSection('amend')">
                  <div class="action-icon">‚ñ≥</div>
                  <div>
                    <div style="font-weight: 500;">Request Amendment</div>
                    <div style="font-size: 12px; color: #64748b;">Make adjustments to your content</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- BRANDING SESSIONS PROMO BANNER -->
        <div class="branding-promo">
          <div class="branding-promo-content">
            <div class="branding-promo-text">
              <h2>NEW: Personal Branding Sessions</h2>
              <p>Personal branding for estate agents. Professional photography and video content to elevate your presence.</p>
              
              <div class="branding-promo-features">
                <span class="feature-badge">10 Signature Shots</span>
                <span class="feature-badge">Social Media Video</span>
                <span class="feature-badge">Complete Package</span>
                <span class="feature-badge">2-7 Day Delivery</span>
              </div>
              
              <div class="branding-promo-cta">
                <button class="btn-branding-primary" onclick="window.open('https://markebmediabookings.as.me/?appointmentType=category:Branding%20Session', '_blank')">
                  Book Your Session ‚Üí
                </button>
                <button class="btn-branding-secondary" onclick="showBrandingInfo()">
                  Learn More
                </button>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- BOOKING -->
      <div id="booking" class="section">
        <div class="booking-container">
          <div class="booking-header">
            <h2 class="booking-title">Book Your Shoot</h2>
            <p class="booking-description">Schedule your professional shoots. Choose your preferred date and time, and we'll handle the rest.</p>
          </div>
          <div class="booking-iframe-container">
            <iframe 
              src="https://app.acuityscheduling.com/schedule.php?owner=32946394&ref=embedded_csp" 
              title="Schedule Appointment" 
              class="booking-iframe"
              frameBorder="0" 
              allow="payment">
            </iframe>
          </div>
        </div>
      </div>

      <!-- GALLERY -->
      <div id="gallery" class="section">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Your Photo Gallery</h2>
            <p class="card-subtitle">View and download your completed photography projects</p>
          </div>
          <div class="card-content">
            <div class="gallery-grid" id="galleryGrid">
              <div class="gallery-item" style="background:#fff;border:1px solid #e2e8f0;border-radius:12px;overflow:hidden;">
                <div class="gallery-image" style="width:100%;height:200px;background:linear-gradient(135deg,#667eea 0%, #764ba2 100%);display:flex;align-items:center;justify-content:center;color:#fff;font-size:48px;">IMG</div>
                <div class="gallery-info" style="padding:20px;">
                  <div class="gallery-title" style="font-weight:600;color:#0f172a;margin-bottom:8px;">Welcome to your gallery</div>
                  <div class="gallery-date" style="color:#64748b;font-size:14px;margin-bottom:12px;">Your completed projects will appear here</div>
                  <span class="gallery-status status-processing" style="display:inline-block;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:500;background:#fef3c7;color:#d97706;">Coming Soon</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- COPYRYTA -->
      <div id="copyryta" class="section">
        <div class="card" style="padding:24px">
          <div class="card-header">
            <h2 class="card-title">CopyRyta AI</h2>
            <p class="card-subtitle">Open your AI copywriting workspace in a dedicated page.</p>
          </div>
          <div class="card-content">
            <button class="btn btn-primary" onclick="openCopyryta()">Open CopyRyta</button>
          </div>
        </div>
      </div>

      <!-- CONTENT TRACKING -->
      <div id="tracking" class="section">
        <div class="card" style="padding:24px">
          <div class="card-header">
            <h2 class="card-title">Track Your Content</h2>
            <p class="card-subtitle">Stay updated on your property marketing progress with real-time tracking</p>
          </div>
          <div class="card-content">
            <div style="max-width:520px">
              <input id="trackingInput" type="text" class="form-input" placeholder="Enter your tracking code" style="width:100%;padding:14px 16px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;">
            </div>
            <div style="margin-top:12px">
              <button class="btn btn-primary" onclick="trackBooking()">üîç Track Progress</button>
            </div>
            <div class="result-container"><div id="result" style="margin-top:16px;"></div></div>
          </div>
        </div>
      </div>

<!-- CONTENT CALENDAR -->
<div id="calendar" class="section">
  <div class="calendar-container">
    <div class="calendar-header-content">
      <div class="calendar-title-section">
        <h2>Your Content Calendar</h2>
        <p>Click on any date to view and manage your scheduled content</p>
      </div>
      <div class="calendar-controls">
        <button class="calendar-nav-btn" onclick="previousMonth()">‚óÄ Prev</button>
        <span class="calendar-current-month" id="currentMonthDisplay"></span>
        <button class="calendar-nav-btn" onclick="nextMonth()">Next ‚ñ∂</button>
      </div>
    </div>

    <div id="calendarLoading" style="display:none;text-align:center;padding:40px;">
      <div class="spinner"></div>
      <p style="margin-top:16px;color:#fff;">Loading your content calendar...</p>
    </div>

  <!-- Calendar Grid -->
<div class="calendar-view">
  <div class="calendar-weekdays">
    <div>Mon</div>
    <div>Tue</div>
    <div>Wed</div>
    <div>Thu</div>
    <div>Fri</div>
    <div>Sat</div>
    <div>Sun</div>
  </div>
  <div class="calendar-days-grid" id="calendarDaysGrid"></div>
</div>

<div id="calendarEmpty" class="calendar-empty-state" style="display:none;">
  <div style="font-size:48px;margin-bottom:16px;">üìÖ</div>
  <h3>No Content Scheduled Yet</h3>
  <p>You don't have any social media content scheduled at the moment.<br>Interested in having us manage your social media presence?</p>
  
  <div class="social-media-promo">
    <div class="social-media-promo-content">
      <h2>Social Media Management for Estate Agents</h2>
      <p>Let us handle your social media so you can focus on selling properties. Professional content creation, scheduling, and engagement management.</p>
      
      <div class="social-media-features">
        <span class="sm-feature-badge">üì± Daily Posting</span>
        <span class="sm-feature-badge">‚úçÔ∏è Professional Copywriting</span>
        <span class="sm-feature-badge">üìä Performance Analytics</span>
        <span class="sm-feature-badge">üéØ Targeted Strategy</span>
      </div>
      
      <a href="mailto:commercial@markebmedia.com?subject=Social%20Media%20Management%20Enquiry" class="btn-sm-primary">
        Get Started with Social Media Management ‚Üí
      </a>
    </div>
  </div>
</div>

  <!-- Content Detail Modal -->
  <div class="content-modal" id="contentModal" onclick="closeContentModal(event)">
    <div class="content-modal-dialog" onclick="event.stopPropagation()">
      <div class="content-modal-header">
        <h3 id="modalDate"></h3>
        <button class="modal-close" onclick="closeContentModal()">&times;</button>
      </div>
      <div class="content-modal-body" id="modalContent"></div>
    </div>
  </div>
</div>
</div>
      <!-- REQUEST AMENDMENT (with file upload and Render endpoints) -->
      <div id="amend" class="section">
        <div class="card" style="padding:24px">
          <div class="card-header">
            <h2 class="card-title">Request an Amendment</h2>
            <p class="card-subtitle">We're here to help get things just right for your property marketing</p>
          </div>
          <div class="card-content">
            <form id="amendForm">
              <div class="form-group" style="margin-bottom:16px">
                <label class="form-label" style="display:block;font-weight:600;margin-bottom:6px;">Your Name</label>
                <input type="text" name="clientName" required class="form-input" placeholder="Enter your full name" style="width:100%;padding:12px 16px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;">
              </div>
              <div class="form-group" style="margin-bottom:16px">
                <label class="form-label" style="display:block;font-weight:600;margin-bottom:6px;">Your Email</label>
                <input type="email" name="email" required class="form-input" placeholder="your.email@example.com" style="width:100%;padding:12px 16px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;">
              </div>
              <div class="form-group" style="margin-bottom:16px">
                <label class="form-label" style="display:block;font-weight:600;margin-bottom:6px;">Tracking Code</label>
                <input type="text" name="trackingCode" required pattern="MK.*" title="Tracking code must start with MK." class="form-input" placeholder="MK..." oninput="this.value=this.value.toUpperCase()" style="width:100%;padding:12px 16px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;">
                <div id="trackingStatus" class="tracking-status" style="display:none;margin-top:8px;padding:10px;border-radius:8px;"></div>
              </div>
              <div class="form-group" style="margin-bottom:16px">
                <label class="form-label" style="display:block;font-weight:600;margin-bottom:6px;">What needs adjusting?</label>
                <div class="action-grid" style="grid-template-columns:repeat(auto-fit,minmax(160px,1fr));">
                  <label class="action-item"><input type="checkbox" name="mediaType" value="Photos"> Photos</label>
                  <label class="action-item"><input type="checkbox" name="mediaType" value="Video"> Video</label>
                  <label class="action-item"><input type="checkbox" name="mediaType" value="Drone"> Drone</label>
                  <label class="action-item"><input type="checkbox" name="mediaType" value="Captions"> Captions</label>
                  <label class="action-item"><input type="checkbox" name="mediaType" value="Other"> Other</label>
                </div>
              </div>
              <div class="form-group" style="margin-bottom:16px">
                <label class="form-label" style="display:block;font-weight:600;margin-bottom:6px;">Details / Notes</label>
                <textarea name="amendDetails" required class="form-input" placeholder="Please describe the specific changes you'd like us to make..." style="width:100%;padding:12px 16px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;min-height:120px"></textarea>
              </div>

              <!-- File upload -->
              <div class="form-group" style="margin-bottom:16px">
                <label class="form-label" style="display:block;font-weight:600;margin-bottom:6px;">Reference Files (Optional)</label>
                <div class="file-upload-area" id="fileUploadArea">
                  <div style="font-size:1.1em;color:#6B7280;margin-bottom:8px;">Drag & drop files here, or click to browse</div>
                  <div style="font-size:.9em;color:#94a3b8;">Max 150MB each ‚Ä¢ Images, PDFs, Videos supported</div>
                  <button type="button" class="btn btn-primary" id="browseButton" style="margin-top:10px;">Choose Files</button>
                  <input type="file" id="fileInput" style="display:none" multiple accept="image/*,video/*,.pdf,.doc,.docx,.txt">
                </div>
                <div class="file-preview" id="filePreview"></div>
                <div class="upload-progress" id="uploadProgress">
                  <div>Uploading files...</div>
                  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                  <div id="progressText">0%</div>
                </div>
              </div>

              <button id="submitBtn" type="submit" class="btn btn-primary" style="width:100%">üì§ Submit Amendment Request</button>
            </form>

            <div id="responseMessage" class="response-message" style="display:none;margin-top:12px;font-weight:600;text-align:center"></div>

            <div class="info-box" style="margin-top:20px;background:linear-gradient(135deg,#EBF4FF 0%, #DBEAFE 100%);border:2px solid #3B82F6;border-radius:16px;padding:20px;text-align:center;">
              <h3 style="color:#1E40AF;font-weight:700;margin-bottom:10px;font-size:1.1em;">Free Amendment Policy</h3>
              <p style="color:#1E3A8A;font-weight:500;margin-bottom:8px;">Each project comes with <span style="color:#3B82F6;font-weight:700;">up to two free amendment requests</span> within <span style="color:#3B82F6;font-weight:700;">7 days of delivery</span> using your tracking code.</p>
              <p style="color:#1E3A8A;font-weight:500;">Our team typically completes all amendments within <span style="color:#3B82F6;font-weight:700;">24 hours</span>.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- SETTINGS (profile only; integrations removed) -->
      <div id="settings" class="section">
        <div class="card" style="padding:24px">
          <div class="card-header">
            <h2 class="card-title">Profile</h2>
            <p class="card-subtitle">Update your display details (local to your device)</p>
          </div>
          <div class="card-content">
            <div class="form-group" style="margin-bottom:16px">
              <label class="form-label" style="display:block;font-weight:600;margin-bottom:6px;">Name</label>
              <input id="settingsName" class="form-input" placeholder="Your name" style="width:100%;padding:12px 16px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;">
            </div>
            <div class="form-group" style="margin-bottom:16px">
              <label class="form-label" style="display:block;font-weight:600;margin-bottom:6px;">Email</label>
              <input id="settingsEmail" type="email" class="form-input" placeholder="you@example.com" style="width:100%;padding:12px 16px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;">
            </div>
            <button class="btn btn-primary" onclick="saveProfile()">Save Profile</button>
          </div>
        </div>
      </div>

      <!-- TERMS & CONDITIONS -->
      <div id="terms" class="section">
        <div class="card" style="padding:24px">
          <div class="card-header">
            <h2 class="card-title">Terms & Conditions</h2>
            <p class="card-subtitle">Our service terms and policies</p>
          </div>
          <div class="card-content">
            <ol style="padding-left:20px;line-height:1.8;">
              <li><strong>Services</strong><br>Markeb Media provides professional property marketing media services, including but not limited to: Photography, Videography, and Drone Footage. We reserve the right to modify, suspend, or discontinue any service at any time without prior notice.</li>
              <li><strong>Payment Terms</strong><br>Card details must be provided at booking. Full payment is charged automatically once editing begins. Clients may also choose to pay upfront. Payments are securely processed by Stripe. If payment fails, Markeb Media reserves the right to withhold delivery.</li>
              <li><strong>Cancellation and Refund Policy</strong><br>Clients may cancel with at least 24 hours' notice. Late cancellations may be charged in full. No refunds for completed work. Media produced prior to cancellation remains property of Markeb Media until full payment is received.</li>
              <li><strong>Delivery of Media</strong><br>Media is delivered digitally within 48 hours. Ownership transfers only upon full payment.</li>
              <li><strong>Usage Rights and Intellectual Property</strong><br>Markeb Media retains ownership until full payment. Upon payment, a non-exclusive, perpetual, non-transferable license is granted for property marketing. Reselling or redistribution without consent is prohibited.</li>
              <li><strong>Revisions and Amendment Requests</strong><br>Requests must be submitted within 7 days. Two free amendments per project are included. Further amendments may incur charges. Extensive changes or re-shoots may affect delivery timelines.</li>
              <li><strong>Limitation of Liability</strong><br>Markeb Media is not liable for technical issues, indirect damages, or delays beyond our control (e.g., weather, equipment failure, or regulatory changes).</li>
              <li><strong>Drone Operations</strong><br>All drone operations comply with UK CAA regulations and are subject to weather and legal restrictions.</li>
              <li><strong>Data Usage and Privacy</strong><br>Payments are processed securely by Stripe. Markeb Media does not store card details. Personal data is used only for service delivery and processed per UK data protection laws.</li>
              <li><strong>Amendments to Terms</strong><br>Markeb Media may update these Terms &amp; Conditions at any time. Continued use of services constitutes acceptance.</li>
              <li><strong>Governing Law</strong><br>These Terms &amp; Conditions are governed by the laws of England and Wales. Disputes are subject to the exclusive jurisdiction of the courts of England and Wales.</li>
            </ol>
          </div>
        </div>
      </div>

      <!-- PRIVACY POLICY -->
      <div id="privacy" class="section">
        <div class="card" style="padding:24px">
          <div class="card-header">
            <h2 class="card-title">Privacy Policy</h2>
            <p class="card-subtitle">How we handle your data</p>
          </div>
          <div class="card-content">
            <p style="margin-bottom:16px;"><em>Effective Date: 12/10/2024</em></p>
            <ol style="padding-left:20px;line-height:1.8;">
              <li><strong>Introduction</strong><br>We are committed to protecting your privacy and ensuring that your information is handled securely in compliance with GDPR.</li>
              <li><strong>Information We Collect</strong><br>Contact info (name, email, phone), property info, payment info (via Stripe), amendment requests, and other voluntary information.</li>
              <li><strong>How We Use Your Information</strong><br>To provide services, process payments, deliver media, communicate with clients, handle amendments, improve services, and ensure compliance.</li>
              <li><strong>Use of Media for Marketing</strong><br>Media may be used for promotional purposes (website, social media, marketing materials). Clients may opt out by emailing <a href="mailto:commercial@markebmedia.com">commercial@markebmedia.com</a>.</li>
              <li><strong>Data Sharing</strong><br>Shared only with service providers (Stripe, Dropbox/OneDrive, Airtable) or if legally required. Some providers may process data internationally with GDPR safeguards.</li>
              <li><strong>Data Security</strong><br>We implement technical and organizational measures to protect your data. Stripe securely processes all payment information.</li>
              <li><strong>Retention of Data</strong><br>Data is kept only as long as necessary for services, compliance, or dispute resolution, then securely deleted or anonymized.</li>
              <li><strong>Your Rights Under GDPR</strong><br>You have rights to access, correction, deletion, restriction, objection, and portability. Contact us to exercise these rights.</li>
              <li><strong>Cookies and Tracking</strong><br>We use cookies to improve user experience. By using our website, you consent to cookies. Manage cookies in your browser settings.</li>
              <li><strong>Updates</strong><br>We may update this Privacy Policy from time to time. Updates will be posted here with a revised effective date.</li>
              <li><strong>Contact Us</strong><br>Email: <a href="mailto:commercial@markebmedia.com">commercial@markebmedia.com</a></li>
            </ol>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="page-footer">
    <div class="footer-buttons">
      <button class="footer-btn" onclick="showSection('terms')">Terms & Conditions</button>
      <button class="footer-btn" onclick="showSection('privacy')">Privacy Policy</button>
    </div>
    <div class="footer-copyright" id="footerCopyright">¬© 2025 Markeb Media. All rights reserved.</div>
  </div>

  <!-- Auth/session helper -->
  <script src="./assets/js/airtable.js"></script>
  <script>
    /* ====== endpoints ====== */
    const NETLIFY_ENDPOINTS = {
  acuity: '/.netlify/functions/acuity-data',
  projects: '/.netlify/functions/airtable-data',
  track: '/.netlify/functions/track-content',
  calendar: '/.netlify/functions/content-calendar',
  updateContent: '/.netlify/functions/update-content',
};

    const fmtGBP = (n) => (typeof n === 'number'
      ? n.toLocaleString('en-GB', { style: 'currency', currency: 'GBP' })
      : '¬£0');

    function toggleSidebar(){document.querySelector('.sidebar').classList.toggle('open');document.querySelector('.mobile-overlay').classList.toggle('active');}
    function closeSidebar(){document.querySelector('.sidebar').classList.remove('open');document.querySelector('.mobile-overlay').classList.remove('active');}
    function showSection(id) {
  console.log('showSection called with:', id);
  
  // Hide all sections
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  
  // Show the target section
  const targetSection = document.getElementById(id);
  if (targetSection) {
    targetSection.classList.add('active');
    console.log('‚úÖ Section activated:', id);
  } else {
    console.error('‚ùå Section not found:', id);
  }
  
  // Update navigation
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  
  const clickedNav = [...document.querySelectorAll('.nav-item')].find(n => {
    const onclick = n.getAttribute('onclick');
    return onclick && onclick.includes(`showSection('${id}')`);
  });
  
  if (clickedNav) {
    clickedNav.classList.add('active');
  }
  
  window.scrollTo({top: 0, behavior: 'smooth'});
  
  if (id === 'calendar') {
    loadContentCalendar();
  }
}
    function openCopyryta(){window.location.href='./copyryta.html';}

    /* üìß Support email function */
    function contactSupport(){
      window.location.href = "mailto:commercial@markebmedia.com?subject=Support%20Request&body=Hello%20Markeb%20Media%20Team,";
    }

   function contactSocialMedia(){
  window.location.href = "mailto:commercial@markebmedia.com?subject=Social%20Media%20Management%20Inquiry&body=Hi%20Markeb%20Media%20Team,%0D%0A%0D%0AI'm%20interested%20in%20learning%20more%20about%20your%20social%20media%20management%20services.%0D%0A%0D%0APlease%20send%20me%20more%20information.";
}

    /* Greeting */
    function setDashboardGreeting(){
      const titleEl=document.getElementById('pageTitle');
      const user=window.AirtableAPI?.getCurrentUser?.()||null;
      const name=(user&&user.name)||localStorage.getItem('user_name')||'there';
      const action=localStorage.getItem('auth_action');
      titleEl.textContent=(action==='signup')?`Welcome, ${name}`:`Welcome back, ${name}`;
      localStorage.removeItem('auth_action');
    }

    /* Header user info */
    function populateHeaderUser(){
      const u = window.AirtableAPI?.getCurrentUser?.() || null;
      const name = (u && u.name) || localStorage.getItem('user_name') || 'Markeb Client';
      const email = (u && u.email) || localStorage.getItem('user_email') || 'client@markebmedia.com';

      document.getElementById('userName').textContent = name;
      document.getElementById('userEmail').textContent = email;
      document.getElementById('userAvatar').textContent = (name?.[0] || 'M').toUpperCase();
    }

    function saveProfile(){
      const name=document.getElementById('settingsName').value.trim();
      const email=document.getElementById('settingsEmail').value.trim();
      if(!name||!email){alert('Please enter both name and email');return;}
      localStorage.setItem('user_name',name);
      localStorage.setItem('user_email',email);
      populateHeaderUser();
      alert('Profile saved');
    }

    /* simple POST helper */
    async function fetchJSON(url, bodyObj){
      const res=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(bodyObj||{})});
      const text=await res.text();
      if(!res.ok) throw new Error(`${res.status} ${res.statusText}: ${text}`);
      try{return JSON.parse(text);}catch{return {};}
    }

    /* === Metrics === */
    async function loadAcuityMetrics(email){
      try{
        const data=await fetchJSON(NETLIFY_ENDPOINTS.acuity,{ userEmail: email });
        document.getElementById('totalBookings').textContent=data.totalBookings ?? 0;
        document.getElementById('totalSpending').textContent=fmtGBP(data.totalInvestment ?? 0);

        const list=document.getElementById('activityList');
        const appts=Array.isArray(data.appointments)?data.appointments.slice(0,5):[];
        appts.forEach(a=>{
          const when=a.datetime||a.time||a.date||'';
          const title=a.type||a.calendar||'Appointment';
          const row=document.createElement('div');
          row.className='activity-item';
          row.innerHTML=`<div class="activity-icon">‚ñ†</div><div class="activity-content"><div class="activity-title">${title}</div><div class="activity-time">${when}</div></div>`;
          list.appendChild(row);
        });
      }catch(e){console.warn('Acuity metrics error:',e.message);}
    }

    async function loadAirtableProjectMetrics(email){
      try{
        const data=await fetchJSON(NETLIFY_ENDPOINTS.projects,{ userEmail: email });
        document.getElementById('completedProjects').textContent=data.completedProjects ?? 0;

        const list=document.getElementById('activityList');
        const projects=Array.isArray(data.projects)?data.projects.slice(0,5):[];
        projects.forEach(p=>{
          const f=p.fields||{};
          const title = f['A Project Address'] || f['Property'] || f['Title'] || 'Project';
          const status=f['Status']||'In progress';
          const row=document.createElement('div');
          row.className='activity-item';
          row.innerHTML=`<div class="activity-icon">‚úì</div><div class="activity-content"><div class="activity-title">${title}</div><div class="activity-time">Status: ${status}</div></div>`;
          list.appendChild(row);
        });
      }catch(e){console.warn('Airtable project metrics error:',e.message);}
    }

    async function loadMemberSince(email){
      const el = document.getElementById('memberSince');

      // 1) Try Airtable user profile
      try {
        const resp = await window.AirtableAPI.getUserData(email);
        const raw = resp?.userData?.createdDate;
        if (resp?.success && raw) {
          const d = new Date(raw);
          if (!Number.isNaN(d.getTime())) {
            el.textContent = String(d.getFullYear());
            return;
          }
        }
      } catch (e) {
        console.warn('memberSince (profile) err:', e?.message || e);
      }

      // 2) Try earliest project/appointment year as a backup (already fetched elsewhere)
      try {
        // You might have cached data from your earlier calls; if not, you can call again:
        const pro = await fetchJSON(NETLIFY_ENDPOINTS.projects, { userEmail: email });
        const years = [];
        if (Array.isArray(pro?.projects)) {
          pro.projects.forEach(p => {
            const f = p.fields || {};
            const raw = f['Created'] || f['Date'] || f['Shoot Date'] || f['Created time'];
            if (raw) {
              const d = new Date(raw);
              if (!Number.isNaN(d.getTime())) years.push(d.getFullYear());
            }
          });
        }
        if (years.length) {
          el.textContent = String(Math.min(...years));
          return;
        }
      } catch (e) {
        console.warn('memberSince (projects) err:', e?.message || e);
      }

      // 3) Final fallback: current year (avoid hard-coded 2024)
      el.textContent = String(new Date().getFullYear());
    }

    async function loadDashboardData(){
      const user=window.AirtableAPI.getCurrentUser();
      if(!user?.email) return;

      const list=document.getElementById('activityList');
      list.innerHTML=`<div class="activity-item"><div class="activity-icon">+</div><div class="activity-content"><div class="activity-title">Signed in</div><div class="activity-time">${new Date().toLocaleString('en-GB')}</div></div></div>`;

      await Promise.all([
        loadAcuityMetrics(user.email),
        loadAirtableProjectMetrics(user.email),
        loadMemberSince(user.email),
      ]);
    }

    /* === Content Tracking (serverless) === */
    async function trackBooking() {
      const code = (document.getElementById('trackingInput').value || '').trim();
      const resultEl = document.getElementById('result');

      if (!code) {
        resultEl.innerHTML = '<div class="warning-message">‚ö†Ô∏è Please enter your tracking code to continue.</div>';
        return;
      }
      resultEl.innerHTML = '<div class="spinner"></div>';

      try {
        const res = await fetch(NETLIFY_ENDPOINTS.track, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ trackingCode: code })
        });
        const data = await res.json();
        if (!res.ok || !data?.record) {
          resultEl.innerHTML = '<div class="error-message">‚ùó No booking found with that tracking code. Please check your code and try again.</div>';
          return;
        }

        const f = data.record;
        const stages = ['Booked','Editing','Quality Control','Ready for Delivery'];
        const icons  = ['üìÖ','üé¨','üîç','‚úÖ'];
        const idx = Math.max(0, stages.indexOf(f.status || ''));

        const progressPct = (idx / (stages.length - 1)) * 80 + 10;
        const shootDate = f.shootDate ? new Date(f.shootDate) : null;
        const fmtDate = (d)=> d ? `${String(d.getDate()).padStart(2,'0')}-${String(d.getMonth()+1).padStart(2,'0')}-${d.getFullYear()}` : '-';

        let deadlineHTML = '';
        if (shootDate && (f.status === 'Editing' || f.status === 'Quality Control')) {
          const now = new Date();
          const start = new Date(shootDate); start.setDate(start.getDate()+1); start.setHours(0,0,0,0);
          const final = new Date(start.getTime() + (48*60*60*1000));
          const hrsLeft = Math.max(Math.floor((final - now)/(1000*60*60)), 0);
          const fmtFinal = `${String(final.getDate()).padStart(2,'0')}-${String(final.getMonth()+1).padStart(2,'0')}-${final.getFullYear()} ${String(final.getHours()).padStart(2,'0')}:00`;
          deadlineHTML = `
            <div class="deadline-alert">
              <div style="font-size:1.1em;margin-bottom:6px;">‚è≥ <strong>Delivery Timeline</strong></div>
              <div>Estimated completion: <strong>${hrsLeft} hours remaining</strong></div>
              <div>Expected delivery: <strong>${fmtFinal}</strong></div>
            </div>`;
        }

        const progressHTML = `
          <div class="progress-container">
            <div class="progress-line" style="width:${progressPct}%;"></div>
            ${stages.map((s,i)=>`
              <div class="progress-step ${i<=idx?'active':''}">
                <div class="icon">${icons[i]}</div>
                <div class="label">${s}</div>
              </div>`).join('')}
          </div>`;

        const deliveryHTML = (f.status === 'Ready for Delivery' && f.deliveryLink)
          ? `<div class="delivery-link">
               <div style="font-size:1.05em;margin-bottom:8px;">üéâ <strong>Your Content is Ready!</strong></div>
               <a href="${f.deliveryLink}" target="_blank" style="color:#065F46;text-decoration:none;font-weight:700;">üì• Download Your Files</a>
             </div>` : '';

        resultEl.innerHTML = `
          ${progressHTML}
          <div class="info-grid">
            <div class="info-item"><strong>üéØ Current Status:</strong><div style="margin-top:5px;color:#3B82F6;font-weight:700;">${f.status || '-'}</div></div>
            <div class="info-item"><strong>üë§ Customer:</strong><div style="margin-top:5px;">${f.customerName || '-'}</div></div>
            <div class="info-item"><strong>üè∑Ô∏è Service Type:</strong><div style="margin-top:5px;">${f.serviceType || '-'}</div></div>
            <div class="info-item"><strong>üìÖ Shoot Date:</strong><div style="margin-top:5px;">${fmtDate(shootDate)}</div></div>
            <div class="info-item"><strong>üìç Project Address:</strong><div style="margin-top:5px;">${f.projectAddress || '-'}</div></div>
          </div>
          ${deadlineHTML}
          ${deliveryHTML}
          <div style="text-align:center;margin-top:10px;"><a href="#" onclick="location.reload()" style="color:#334155;text-decoration:none;font-weight:600">üîÅ Track another project</a></div>
        `;
      } catch (e) {
        console.error(e);
        resultEl.innerHTML = '<div class="error-message">‚ùå There was an error retrieving your tracking info. Please try again later.</div>';
      }
    }

    /* === Amend: Render endpoints + uploads === */
    let selectedFiles = [];
    const maxFileSize = 150 * 1024 * 1024;

    document.addEventListener('DOMContentLoaded', () => {
      const area = document.getElementById('fileUploadArea');
      const input = document.getElementById('fileInput');
      const browse = document.getElementById('browseButton');

      if (!area || !input || !browse) return;

      const stop = e => { e.preventDefault(); e.stopPropagation(); };

      ['dragenter','dragover','dragleave','drop'].forEach(evt => {
        area.addEventListener(evt, stop, false);
      });
      area.addEventListener('dragover', () => area.classList.add('dragover'));
      area.addEventListener('dragleave', () => area.classList.remove('dragover'));
      area.addEventListener('drop', e => { area.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });

      area.addEventListener('click', () => input.click());
      browse.addEventListener('click', e => { e.stopPropagation(); input.click(); });
      input.addEventListener('change', e => handleFiles(e.target.files));
    });

    function handleFiles(files){
      const list = Array.from(files);
      for (const f of list){
        if (f.size > maxFileSize){ alert(`File "${f.name}" is too large (max 150MB).`); continue; }
        if (selectedFiles.find(x => x.name===f.name && x.size===f.size)) { continue; }
        selectedFiles.push(f);
      }
      updateFilePreview();
    }

    function updateFilePreview(){
      const wrap = document.getElementById('filePreview');
      if (!wrap) return;
      if (selectedFiles.length === 0){ wrap.style.display='none'; wrap.innerHTML=''; return; }
      wrap.style.display='block';
      const icon = (t)=> t.startsWith('image/')?'üñºÔ∏è':t.startsWith('video/')?'üé•':t.includes('pdf')?'üìÑ':(t.includes('word')||t.includes('document'))?'üìù':'üìé';
      const size = (b)=>{ if(!b) return '0 B'; const k=1024, units=['B','KB','MB','GB']; const i=Math.floor(Math.log(b)/Math.log(k)); return (b/Math.pow(k,i)).toFixed(2)+' '+units[i]; };
      wrap.innerHTML = selectedFiles.map((f,i)=>`
        <div class="file-item">
          <div style="display:flex;align-items:center;gap:12px;">
            <div style="font-size:1.3em">${icon(f.type)}</div>
            <div>
              <div style="font-weight:600;color:#1F2E3C">${f.name}</div>
              <div style="font-size:.85em;color:#6B7280">${size(f.size)}</div>
            </div>
          </div>
          <button type="button" class="file-remove" onclick="removeFile(${i})">Remove</button>
        </div>
      `).join('');
    }

    function removeFile(i){
      selectedFiles.splice(i,1);
      updateFilePreview();
    }

    async function uploadFilesMulti(trackingCode) {
      if (!selectedFiles.length) return { attachments: [], folder: null };

      const fd = new FormData();
      fd.append('trackingCode', trackingCode);
      for (const f of selectedFiles) fd.append('files', f);

      const progress = document.getElementById('uploadProgress');
      const fill = document.getElementById('progressFill');
      const text = document.getElementById('progressText');

      const data = await new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.open('POST', 'https://markeb-amend-api.onrender.com/api/upload-multi');

        progress.style.display = 'block';
        xhr.upload.onprogress = (e) => {
          if (!e.lengthComputable) return;
          const pct = Math.round((e.loaded / e.total) * 100);
          fill.style.width = pct + '%';
          text.textContent = pct + '%';
        };

        xhr.onload = () => {
          progress.style.display = 'none';
          try {
            const res = JSON.parse(xhr.responseText);
            if (xhr.status >= 200 && xhr.status < 300) resolve(res);
            else reject(new Error(res.message || 'Upload failed'));
          } catch {
            reject(new Error('Invalid server response'));
          }
        };

        xhr.onerror = () => { progress.style.display = 'none'; reject(new Error('Network error')); };
        xhr.send(fd);
      });

      // Build attachments list (prefer per-file URLs if backend returns them; fallback to folder link)
      const attachments = Array.isArray(data.files)
        ? data.files.map(f => ({
            filename: f.filename,
            url: f.url || data.folder?.url || '',
            size: f.size,
            type: f.type || ''
          }))
        : [];

      return { attachments, folder: data.folder || null };
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      const tc = document.querySelector('input[name="trackingCode"]');
      if (tc){
        tc.addEventListener('blur', ()=> checkTrackingCodeDeadline(tc.value.trim()));
      }
    });

    let isExpired=false;
    async function checkTrackingCodeDeadline(trackingCode){
      const statusDiv=document.getElementById('trackingStatus');
      const submitBtn=document.getElementById('submitBtn');
      if (!trackingCode) return;
      statusDiv.style.display='block';
      statusDiv.style.background='#eef2ff';
      statusDiv.style.border='1px solid #bfdbfe';
      statusDiv.style.color='#3730a3';
      statusDiv.textContent='üîç Checking amendment eligibility...';

      try{
        const res=await fetch('https://markeb-amend-api.onrender.com/api/check-deadline',{
          method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({trackingCode})
        });
        const data=await res.json();
        if(!res.ok){
          statusDiv.style.background='#fee2e2'; statusDiv.style.border='1px solid #ef4444'; statusDiv.style.color='#991b1b';
          statusDiv.textContent='‚ùå '+(data.message||'Unable to verify tracking code');
          isExpired=true; submitBtn.disabled=true; submitBtn.textContent='‚ö†Ô∏è Not Eligible';
          return;
        }
        if(data.isExpired){
          statusDiv.style.display='none'; isExpired=true; submitBtn.disabled=true; submitBtn.textContent='‚ö†Ô∏è Amendment Window Expired';
        }else{
          statusDiv.style.display='none'; isExpired=false; submitBtn.disabled=false; submitBtn.textContent='üì§ Submit Amendment Request';
        }
      }catch(err){
        statusDiv.style.background='#fee2e2'; statusDiv.style.border='1px solid #ef4444'; statusDiv.style.color='#991b1b';
        statusDiv.textContent='‚ùå Network error. Please try again.';
      }
    }

    document.getElementById('amendForm').addEventListener('submit',async e=>{
      e.preventDefault();
      const form=e.target, btn=document.getElementById('submitBtn'), msg=document.getElementById('responseMessage');
      const trackingValue=form.trackingCode.value.trim();
      if(isExpired){ msg.style.display='block'; msg.className='response-message error'; msg.textContent='‚ùå The amendment window for this tracking code has expired.'; return; }
      if(!/^MK.*$/.test(trackingValue)){ alert('Tracking code must start with MK.'); form.trackingCode.focus(); return; }
      const mediaTypes=Array.from(form.querySelectorAll('input[name="mediaType"]:checked')).map(cb=>cb.value);
      if(mediaTypes.length===0){ alert('Please select at least one item that needs adjusting.'); return; }

      btn.disabled=true; btn.textContent='‚è≥ Submitting...'; msg.style.display='none';

      try{
       let uploaded = [];
        if (selectedFiles.length>0){
          btn.textContent='üì§ Uploading files...';
          const up = await uploadFilesMulti(trackingValue);
          uploaded = up.attachments; // keep same payload shape for api/amend
        }

        const payload={
          customerName:form.clientName.value.trim(),
          email:form.email.value.trim(),
          trackingCode:trackingValue,
          amendmentType:mediaTypes,
          amendmentDescription:form.amendDetails.value.trim(),
          attachments: uploaded
        };
        btn.textContent='‚è≥ Submitting request...';
        const r=await fetch('https://markeb-amend-api.onrender.com/api/amend',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        const j=await r.json();
        msg.style.display='block';
        if(r.ok){
          msg.className='response-message success';
          msg.textContent='‚úÖ Thank you! Your amendment request has been submitted successfully.';
          form.reset(); selectedFiles=[]; updateFilePreview(); document.getElementById('trackingStatus').style.display='none';
        }else{
          msg.className='response-message error';
          msg.textContent='‚ùå '+(j.message||'Submission failed. Please try again.');
        }
      }catch(err){
        msg.style.display='block'; msg.className='response-message error'; msg.textContent='‚ùå Network error. Please check your connection and try again.';
      }
      btn.disabled=false; btn.textContent='üì§ Submit Amendment Request'; msg.scrollIntoView({behavior:'smooth',block:'center'});
    });

    /* Branding Info Modal */
    function showBrandingInfo() {
      const info = `
PERSONAL BRANDING SESSIONS FOR ESTATE AGENTS

Personal branding for estate agents. You're in every shot.

Choose Your Style:
On-location, studio (we source), or hybrid.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

BRANDING PHOTOGRAPHY SESSION - 10 Signature Shots
2 hours @ ¬£414.00

10 Essential Shots:
‚Ä¢ Professional (4): High street with coffee, caf√© with phone, with business owner, neighbourhood portrait
‚Ä¢ Property Action (4): Outside property with tablet, at car with keys, garden path, street view
‚Ä¢ Local Expert (2): Local landmark, community spot

Includes:
‚Ä¢ 2-hour session
‚Ä¢ 10 edited images
‚Ä¢ 2-day delivery

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

BRANDING VIDEOGRAPHY SESSION (For Social Media)
3 hours @ ¬£534.00

15 Social Media Clips:
‚Ä¢ Professional: High street walks, caf√© with phone, business chat, intros
‚Ä¢ Property Action: Outside property with tablet, car with keys, garden paths, views
‚Ä¢ Local Expert: Landmark moments, community spots

Includes:
‚Ä¢ 3-hour session
‚Ä¢ 5 sequences
‚Ä¢ 15 vertical clips (15-30 sec)
‚Ä¢ 3-day delivery

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

COMPLETE BRANDING PACKAGE - Photo & Video
5 hours @ ¬£894.00

Full personal branding suite for estate agents. Photography and video content.

What You Get:
‚Ä¢ 10 Lifestyle Photos: Professional lifestyle, property action, local expert images
‚Ä¢ 15 Social Media Video Clips: 5 sequences edited into 15 vertical clips (15-30 sec)

Includes:
‚Ä¢ 5-hour session (or 2 separate)
‚Ä¢ All images and clips edited
‚Ä¢ 5-7 day delivery
‚Ä¢ Commercial rights

Save ¬£54 vs booking separately

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Ready to boost your personal brand?
Click "Book Your Session" to schedule your branding session.
      `;
      
      alert(info);
      // Or you could create a modal popup instead of alert for a better UX
    }

/* ===== CONTENT CALENDAR ===== */
let calendarData = [];
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

async function loadContentCalendar() {
  const user = window.AirtableAPI?.getCurrentUser?.();
  if (!user?.email) {
    showCalendarError('Please log in to view your content calendar');
    return;
  }

  const loadingEl = document.getElementById('calendarLoading');
  const emptyEl = document.getElementById('calendarEmpty');
  const calendarView = document.querySelector('.calendar-view');

  loadingEl.style.display = 'block';
  calendarView.style.display = 'none';
  emptyEl.style.display = 'none';

  try {
    const data = await fetchJSON(NETLIFY_ENDPOINTS.calendar, { userEmail: user.email });
    
    if (!data.success || !Array.isArray(data.content) || data.content.length === 0) {
      loadingEl.style.display = 'none';
      emptyEl.style.display = 'block';
      return;
    }

    calendarData = data.content;
    loadingEl.style.display = 'none';
    calendarView.style.display = 'block';
    renderMonthCalendar();

  } catch (error) {
    console.error('Calendar error:', error);
    loadingEl.style.display = 'none';
    showCalendarError('Unable to load content calendar. Please try again later.');
  }
}

function previousMonth() {
  currentMonth--;
  if (currentMonth < 0) {
    currentMonth = 11;
    currentYear--;
  }
  renderMonthCalendar();
}

function nextMonth() {
  currentMonth++;
  if (currentMonth > 11) {
    currentMonth = 0;
    currentYear++;
  }
  renderMonthCalendar();
}

function renderMonthCalendar() {
  const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
    'July', 'August', 'September', 'October', 'November', 'December'];
  
  const monthDisplay = document.getElementById('currentMonthDisplay');
  monthDisplay.textContent = `${monthNames[currentMonth]} ${currentYear}`;

  const grid = document.getElementById('calendarDaysGrid');
  grid.innerHTML = '';

  // Get first day of month and number of days
  const firstDay = new Date(currentYear, currentMonth, 1);
  const lastDay = new Date(currentYear, currentMonth + 1, 0);
  const numDays = lastDay.getDate();
  
  // Adjust for Monday start (getDay() returns 0 for Sunday)
  let firstDayOfWeek = firstDay.getDay();
  firstDayOfWeek = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;

  // Add empty cells for days before month starts
  for (let i = 0; i < firstDayOfWeek; i++) {
    const emptyDay = document.createElement('div');
    emptyDay.className = 'calendar-day empty';
    grid.appendChild(emptyDay);
  }

  // Add days of the month
  for (let day = 1; day <= numDays; day++) {
    const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    const contentForDay = getContentForDate(dateStr);
    
    const dayEl = document.createElement('div');
    dayEl.className = 'calendar-day';
    
    if (contentForDay.length > 0) {
      dayEl.classList.add('has-content');
      dayEl.onclick = () => showDayContent(dateStr, contentForDay);
    }
    
    const today = new Date();
    if (day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
      dayEl.classList.add('today');
    }
    
    dayEl.innerHTML = `
      <div class="day-number">${day}</div>
      ${contentForDay.length > 0 ? `<div class="day-content-count">${contentForDay.length} post${contentForDay.length > 1 ? 's' : ''}</div>` : ''}
    `;
    
    grid.appendChild(dayEl);
  }
}

function getContentForDate(dateStr) {
  return calendarData.filter(item => {
    if (!item.postDate) return false;
    const itemDate = new Date(item.postDate);
    const itemDateStr = `${itemDate.getFullYear()}-${String(itemDate.getMonth() + 1).padStart(2, '0')}-${String(itemDate.getDate()).padStart(2, '0')}`;
    return itemDateStr === dateStr;
  });
}

function showDayContent(dateStr, content) {
  const modal = document.getElementById('contentModal');
  const modalDate = document.getElementById('modalDate');
  const modalContent = document.getElementById('modalContent');
  
  const date = new Date(dateStr + 'T12:00:00');
  modalDate.textContent = date.toLocaleDateString('en-GB', { 
    weekday: 'long', 
    day: 'numeric', 
    month: 'long', 
    year: 'numeric' 
  });
  
  modalContent.innerHTML = content.map(item => renderContentItem(item)).join('');
  modal.style.display = 'flex';
}

function closeContentModal(event) {
  const modal = document.getElementById('contentModal');
  modal.style.display = 'none';
}

function renderContentItem(item) {
  const status = Array.isArray(item.status) ? item.status[0] : (item.status || 'Scheduled');
  const statusClass = status.toLowerCase().replace(/\s+/g, '-');
  
  const platformIcon = {
    'Instagram': 'üì∏',
    'Facebook': 'üë•',
    'LinkedIn': 'üíº',
    'Twitter': 'üê¶',
  }[item.platform] || 'üì±';

  const caption = item.caption ? 
    `<div class="modal-caption"><strong>Caption:</strong><br>${escapeHtml(item.caption)}</div>` : '';

  const notesFromMarkeb = item.notesFromMarkeb ? 
    `<div class="modal-notes"><strong>üìù Team Notes:</strong> ${escapeHtml(item.notesFromMarkeb)}</div>` : '';

  const clientNotes = item.notesFromClient ? 
    `<div class="modal-client-notes"><strong>üí¨ Your Notes:</strong> ${escapeHtml(item.notesFromClient)}</div>` : '';

  const mediaLink = item.mediaLink ? 
    `<div><a href="${escapeHtml(item.mediaLink)}" target="_blank" class="media-link">üé¨ View Media</a></div>` : '';

  // Show approve/decline buttons ONLY for "Ready for Review"
  const showApprovalButtons = status === 'Ready for Review';

  const approvalButtons = showApprovalButtons ? `
    <div class="modal-actions" style="margin-top: 20px;">
      <h4 style="font-size: 16px; font-weight: 700; color: #92400e; margin-bottom: 12px;">‚ö° Ready to review this content?</h4>
      <div class="modal-action-buttons">
        <button class="btn btn-success" onclick="approveContent('${item.id}')">‚úì APPROVE & PUBLISH</button>
        <button class="btn btn-danger" onclick="showCommentSection('${item.id}')">‚úó REQUEST CHANGES</button>
      </div>
      <div id="comment-section-${item.id}" style="display: none; margin-top: 16px; padding: 16px; background: #fef3c7; border-radius: 8px; border: 2px solid #f59e0b;">
        <label style="font-size: 14px; font-weight: 600; color: #92400e; margin-bottom: 8px; display: block;">üí¨ What changes would you like?</label>
        <textarea 
          id="notes-${item.id}" 
          placeholder="Please describe the changes you'd like us to make..."
          style="width: 100%; padding: 12px; border: 2px solid #f59e0b; border-radius: 8px; font-size: 14px; font-family: 'Inter', sans-serif; resize: vertical; min-height: 100px;"
        >${escapeHtml(item.notesFromClient || '')}</textarea>
        <button class="btn btn-secondary" onclick="submitChangesRequest('${item.id}')" style="margin-top: 12px;">üì§ Save and Send Comment</button>
        <div id="feedback-${item.id}"></div>
      </div>
    </div>
  ` : '';

  return `
    <div class="modal-content-item status-${statusClass}">
      <div class="modal-item-header">
        <span class="modal-platform">${platformIcon} ${escapeHtml(item.platform || 'Platform')}</span>
        <span class="modal-status calendar-status-badge status-${statusClass}">${escapeHtml(status)}</span>
      </div>
      <h3>${escapeHtml(item.idea || 'Content Idea')}</h3>
      ${caption}
      ${notesFromMarkeb}
      ${clientNotes}
      ${mediaLink}
      ${approvalButtons}
    </div>
  `;
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function showCalendarError(message) {
  const grid = document.getElementById('calendarDaysGrid');
  grid.innerHTML = `<div class="error-message" style="grid-column: 1/-1;">${message}</div>`;
}

async function approveContent(recordId) {
  await updateContentStatus(recordId, 'Approved', 'Content approved by client');
}

async function declineContent(recordId) {
  await updateContentStatus(recordId, 'Drafting', 'Changes requested by client');
}

function showCommentSection(recordId) {
  const commentSection = document.getElementById(`comment-section-${recordId}`);
  if (commentSection) {
    commentSection.style.display = 'block';
    // Focus on the textarea
    const textarea = document.getElementById(`notes-${recordId}`);
    if (textarea) {
      textarea.focus();
    }
  }
}

async function submitChangesRequest(recordId) {
  const notesTextarea = document.getElementById(`notes-${recordId}`);
  const notes = notesTextarea ? notesTextarea.value.trim() : '';
  
  if (!notes) {
    showFeedback(recordId, 'Please describe what changes you would like.', 'error');
    return;
  }

  const feedbackEl = document.getElementById(`feedback-${recordId}`);
  if (feedbackEl) {
    feedbackEl.innerHTML = '<div style="text-align:center;padding:10px;"><div class="spinner" style="width:20px;height:20px;margin:0 auto;"></div></div>';
  }

  try {
    const response = await fetchJSON(NETLIFY_ENDPOINTS.updateContent, {
      recordId: recordId,
      status: 'Drafting',
      notesFromClient: notes
    });

    if (response.success) {
      showFeedback(recordId, '‚úì Changes requested and comment sent!', 'success');
      setTimeout(() => {
        closeContentModal();
        loadContentCalendar();
      }, 2000);
    } else {
      showFeedback(recordId, '‚úó Failed to send request. Please try again.', 'error');
    }
  } catch (error) {
    console.error('Error submitting changes request:', error);
    showFeedback(recordId, '‚úó Error sending request. Please try again.', 'error');
  }
}

async function submitClientNotes(recordId) {
  const notesTextarea = document.getElementById(`notes-${recordId}`);
  const notes = notesTextarea ? notesTextarea.value.trim() : '';
  
  if (!notes) {
    showFeedback(recordId, 'Please enter some notes.', 'error');
    return;
  }

  const feedbackEl = document.getElementById(`feedback-${recordId}`);
  if (feedbackEl) {
    feedbackEl.innerHTML = '<div style="text-align:center;padding:10px;"><div class="spinner" style="width:20px;height:20px;margin:0 auto;"></div></div>';
  }

  try {
    const response = await fetchJSON(NETLIFY_ENDPOINTS.updateContent, {
      recordId: recordId,
      notesFromClient: notes
    });

    if (response.success) {
      showFeedback(recordId, '‚úì Notes saved successfully!', 'success');
      const item = calendarData.find(i => i.id === recordId);
      if (item) {
        item.notesFromClient = notes;
      }
    } else {
      showFeedback(recordId, '‚úó Failed to save notes. Please try again.', 'error');
    }
  } catch (error) {
    console.error('Error saving notes:', error);
    showFeedback(recordId, '‚úó Error saving notes. Please try again.', 'error');
  }
}

async function updateContentStatus(recordId, newStatus, message) {
  const feedbackEl = document.getElementById(`feedback-${recordId}`);
  if (feedbackEl) {
    feedbackEl.innerHTML = '<div style="text-align:center;padding:10px;"><div class="spinner" style="width:20px;height:20px;margin:0 auto;"></div></div>';
  }

  const notesTextarea = document.getElementById(`notes-${recordId}`);
  const clientNotes = notesTextarea ? notesTextarea.value.trim() : '';

  try {
    const response = await fetchJSON(NETLIFY_ENDPOINTS.updateContent, {
      recordId: recordId,
      status: newStatus,
      notesFromClient: clientNotes || message
    });

    if (response.success) {
      showFeedback(recordId, `‚úì ${message}`, 'success');
      setTimeout(() => {
        closeContentModal();
        loadContentCalendar();
      }, 2000);
    } else {
      showFeedback(recordId, '‚úó Failed to update. Please try again.', 'error');
    }
  } catch (error) {
    console.error('Error updating content:', error);
    showFeedback(recordId, '‚úó Error updating content. Please try again.', 'error');
  }
}

function showFeedback(recordId, message, type) {
  const feedbackEl = document.getElementById(`feedback-${recordId}`);
  if (feedbackEl) {
    feedbackEl.innerHTML = `<div class="action-feedback ${type}">${message}</div>`;
    setTimeout(() => {
      feedbackEl.innerHTML = '';
    }, 5000);
  }
}

function contactSocialMedia() {
  window.open('https://markebmedia.com/contact', '_blank');
}

    /* boot */
    document.addEventListener('DOMContentLoaded', async ()=>{
      const ok=await window.AirtableAPI.requireAuthentication();
      if(!ok) return;

      const u=window.AirtableAPI.getCurrentUser();
      if(u){ localStorage.setItem('user_email',u.email||''); if(u.name) localStorage.setItem('user_name',u.name); }

      populateHeaderUser();
      setDashboardGreeting();
      loadDashboardData();
    });

    function logoutAll(){
      if(window.AirtableAPI?.logoutUser){ AirtableAPI.logoutUser(); }
      else{ localStorage.clear(); window.location.href='../login.html'; }
    }

    /* Dynamic copyright year */
    (function(){
      const startYear = 2025;
      const currentYear = new Date().getFullYear();
      const yearText = (currentYear > startYear) ? `${startYear}‚Äì${currentYear}` : `${startYear}`;
      document.getElementById('footerCopyright').textContent = `¬© ${yearText} Markeb Media. All rights reserved.`;
    })();
  </script>
  
</body>
</html>