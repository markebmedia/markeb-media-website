<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel - Markeb Media</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: 'Inter', sans-serif;
      background: #f8fafc;
      color: #1e293b;
    }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 999;
      background: #3b82f6;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 16px;
      cursor: pointer;
      font-size: 20px;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    /* Sidebar Navigation */
    .admin-sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: 260px;
      height: 100vh;
      background: #fff;
      border-right: 2px solid #e2e8f0;
      padding: 24px;
      overflow-y: auto;
      z-index: 1000;
      transition: transform 0.3s ease;
    }

    .admin-logo {
      font-size: 24px;
      font-weight: 700;
      color: #3b82f6;
      margin-bottom: 32px;
      text-align: center;
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-section-title {
      font-size: 11px;
      font-weight: 700;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
      padding-left: 12px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 8px;
      color: #64748b;
      text-decoration: none;
      font-weight: 500;
      transition: all .2s ease;
      cursor: pointer;
      margin-bottom: 4px;
    }

    .nav-item:hover {
      background: #f1f5f9;
      color: #0f172a;
    }

    .nav-item.active {
      background: #3b82f6;
      color: #fff;
    }

    .nav-icon {
      font-size: 18px;
      width: 20px;
      text-align: center;
    }

    /* Main Content */
    .admin-main {
      margin-left: 260px;
      min-height: 100vh;
      padding: 24px;
      transition: margin-left 0.3s ease;
    }

    .admin-header {
      background: #fff;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .admin-title {
      font-size: 28px;
      font-weight: 700;
      color: #0f172a;
    }

    .admin-subtitle {
      color: #64748b;
      font-size: 14px;
      margin-top: 4px;
    }

    .admin-badge {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: #fff;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 14px;
    }

    /* Sections */
    .admin-section {
      display: none;
    }

    .admin-section.active {
      display: block;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: #fff;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #3b82f6;
      margin-bottom: 8px;
    }

    .stat-label {
      color: #64748b;
      font-size: 13px;
      font-weight: 500;
    }

    /* Tables */
    .data-table {
      width: 100%;
      background: #fff;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      overflow: hidden;
    }

    .data-table thead {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: #fff;
    }

    .data-table th {
      padding: 16px;
      text-align: left;
      font-weight: 600;
      font-size: 13px;
      text-transform: uppercase;
    }

    .data-table td {
      padding: 16px;
      border-bottom: 1px solid #e2e8f0;
      font-size: 14px;
    }

    .data-table tbody tr:hover {
      background: #f8fafc;
    }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all .2s ease;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: 'Inter', sans-serif;
    }

    .btn-primary {
      background: #3b82f6;
      color: #fff;
    }

    .btn-primary:hover {
      background: #2563eb;
    }

    .btn-success {
      background: #10b981;
      color: #fff;
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn-danger {
      background: #ef4444;
      color: #fff;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-secondary {
      background: #64748b;
      color: #fff;
    }

    .btn-secondary:hover {
      background: #475569;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Calendar */
    .calendar-container {
      background: #fff;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .calendar-nav {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .calendar-current {
      font-size: 20px;
      font-weight: 700;
      color: #0f172a;
      min-width: 200px;
      text-align: center;
    }

    .calendar-view-selector {
      display: flex;
      gap: 4px;
      background: #f1f5f9;
      padding: 4px;
      border-radius: 8px;
    }

    .calendar-view-btn {
      padding: 8px 16px;
      border: none;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      color: #64748b;
      transition: all .2s ease;
    }

    .calendar-view-btn.active {
      background: #fff;
      color: #3b82f6;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .calendar-grid {
      display: grid;
      gap: 1px;
      background: #e2e8f0;
      border: 1px solid #e2e8f0;
    }

    /* Month View */
    .calendar-grid.month {
      grid-template-columns: repeat(7, 1fr);
    }

    .calendar-day-header {
      background: #f8fafc;
      padding: 12px;
      text-align: center;
      font-weight: 600;
      font-size: 12px;
      color: #64748b;
    }

    .calendar-day {
      background: #fff;
      min-height: 120px;
      padding: 8px;
      position: relative;
    }

    .calendar-day-number {
      font-weight: 600;
      font-size: 14px;
      color: #0f172a;
      margin-bottom: 4px;
    }

    .calendar-day.other-month {
      opacity: 0.3;
    }

    .calendar-day.today {
      background: #eff6ff;
      border: 2px solid #3b82f6;
    }

    .calendar-booking {
      background: #3b82f6;
      color: #fff;
      padding: 4px 6px;
      border-radius: 4px;
      font-size: 11px;
      margin-bottom: 2px;
      cursor: pointer;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .calendar-booking:hover {
      background: #2563eb;
    }

    .calendar-booking.reserved {
      background: #f59e0b;
    }

    .calendar-booking.cancelled {
      background: #ef4444;
    }

    /* Drive Time Badge */
    .drive-time-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      background: #dbeafe;
      color: #1e40af;
    }

    .drive-time-badge.warning {
      background: #fef3c7;
      color: #92400e;
    }

    .drive-time-badge.error {
      background: #fee2e2;
      color: #991b1b;
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 52px;
      height: 28px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #cbd5e1;
      transition: .3s;
      border-radius: 28px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }

    .toggle-switch input:checked + .toggle-slider {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(24px);
    }

    /* Filters */
    .filters-bar {
      background: #fff;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .filter-input {
      padding: 10px 14px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      flex: 1;
      min-width: 200px;
    }

    .filter-input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .filter-select {
      padding: 10px 14px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      background: #fff;
      cursor: pointer;
    }

    /* Loading */
    .spinner {
      margin: 30px auto;
      width: 50px;
      height: 50px;
      border: 4px solid #e2e8f0;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-dialog {
      background: #fff;
      border-radius: 16px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      padding: 24px;
      border-bottom: 2px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: #fff;
      border-radius: 16px 16px 0 0;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
    }

    .modal-close {
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: #fff;
      font-size: 28px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all .2s ease;
      line-height: 1;
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 24px;
    }

    .detail-item {
      display: flex;
      justify-content: space-between;
      padding: 16px;
      border-bottom: 1px solid #e2e8f0;
    }

    .detail-item:last-child {
      border-bottom: none;
    }

    .detail-label {
      font-weight: 600;
      color: #64748b;
      font-size: 14px;
    }

    .detail-value {
      color: #0f172a;
      font-weight: 500;
      text-align: right;
    }

    /* Status Badges */
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-paid {
      background: #d1fae5;
      color: #065f46;
    }

    .status-pending {
      background: #fef3c7;
      color: #92400e;
    }

    .status-reserved {
      background: #fef3c7;
      color: #92400e;
    }

    .status-cancelled {
      background: #fee2e2;
      color: #991b1b;
    }

    .status-active {
      background: #d1fae5;
      color: #065f46;
    }

    .status-inactive {
      background: #fee2e2;
      color: #991b1b;
    }

    .info-box {
      background: #eff6ff;
      border: 2px solid #3b82f6;
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
      color: #1e40af;
      font-size: 14px;
    }

    /* Action Buttons Grid */
    .action-buttons-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 24px;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .mobile-menu-btn {
        display: block;
      }

      .admin-sidebar {
        transform: translateX(-100%);
      }

      .admin-sidebar.open {
        transform: translateX(0);
        box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
      }

      .admin-main {
        margin-left: 0;
      }

      .calendar-grid.month .calendar-day {
        min-height: 80px;
      }

      .calendar-booking {
        font-size: 10px;
      }

      .calendar-header {
        flex-direction: column;
      }

      .action-buttons-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .admin-header {
        flex-direction: column;
        gap: 16px;
        text-align: center;
      }

      .admin-title {
        font-size: 24px;
      }

      .filters-bar {
        flex-direction: column;
      }

      .filter-input {
        width: 100%;
        min-width: 100%;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .calendar-grid.month .calendar-day {
        min-height: 60px;
      }

      .data-table {
        font-size: 12px;
      }

      .data-table thead {
        display: none;
      }

      .data-table, 
      .data-table tbody, 
      .data-table tr, 
      .data-table td {
        display: block;
        width: 100%;
      }

      .data-table tr {
        margin-bottom: 20px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 16px;
      }

      .data-table td {
        padding: 8px 0;
        border: none;
        position: relative;
        padding-left: 50%;
      }

      .data-table td:before {
        content: attr(data-label);
        position: absolute;
        left: 0;
        width: 45%;
        padding-right: 10px;
        font-weight: 600;
        color: #64748b;
        font-size: 11px;
        text-transform: uppercase;
      }

      .detail-item {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
      }

      .detail-value {
        text-align: left;
        width: 100%;
      }

      .modal-dialog {
        max-width: 100%;
        margin: 0;
        max-height: 100vh;
        border-radius: 0;
      }

      .modal-header {
        border-radius: 0;
      }
    }
  </style>
</head>
<body>
  <!-- Mobile Menu Button -->
  <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞ Menu</button>

  <!-- Sidebar Navigation -->
  <div class="admin-sidebar" id="adminSidebar">
    <div class="admin-logo">üõ°Ô∏è MARKEB ADMIN</div>

    <div class="nav-section">
      <div class="nav-section-title">Overview</div>
      <div class="nav-item active" onclick="showSection('dashboard')">
        <span class="nav-icon">üìä</span>
        Dashboard
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-section-title">Bookings</div>
      <div class="nav-item" onclick="showSection('calendar')">
        <span class="nav-icon">üìÖ</span>
        Calendar
      </div>
      <div class="nav-item" onclick="showSection('bookings')">
        <span class="nav-icon">üìã</span>
        All Bookings
      </div>
      <div class="nav-item" onclick="showSection('reserved')">
        <span class="nav-icon">üí≥</span>
        Reserved (Need Payment)
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-section-title">Customers</div>
      <div class="nav-item" onclick="showSection('customers')">
        <span class="nav-icon">üë•</span>
        All Customers
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-section-title">Tools</div>
      <div class="nav-item" onclick="window.open('uk-client-map.html', '_blank')">
        <span class="nav-icon">üó∫Ô∏è</span>
        UK Map
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="admin-main">
    <!-- Header -->
    <div class="admin-header">
      <div>
        <div class="admin-title">Admin Panel</div>
        <div class="admin-subtitle">Manage bookings, customers, and payments</div>
      </div>
      <div class="admin-badge">‚ö†Ô∏è ADMIN ACCESS</div>
    </div>

    <!-- Dashboard Section -->
    <div class="admin-section active" id="dashboard">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalBookings">-</div>
          <div class="stat-label">Total Bookings</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="upcomingBookings">-</div>
          <div class="stat-label">Upcoming</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="reservedBookings">-</div>
          <div class="stat-label">Need Payment</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalCustomers">-</div>
          <div class="stat-label">Total Customers</div>
        </div>
      </div>

      <div class="calendar-container">
        <div style="text-align: center; padding: 40px;">
          <h3 style="color: #64748b;">Welcome to the Admin Panel</h3>
          <p style="color: #94a3b8; margin-top: 8px;">Select a section from the sidebar to get started</p>
        </div>
      </div>
    </div>

    <!-- Calendar Section -->
    <div class="admin-section" id="calendar">
      <div class="calendar-container">
        <div class="calendar-header">
          <div class="calendar-nav">
            <button class="btn btn-primary btn-small" onclick="previousPeriod()">‚óÄ Previous</button>
            <div class="calendar-current" id="calendarCurrent">Loading...</div>
            <button class="btn btn-primary btn-small" onclick="nextPeriod()">Next ‚ñ∂</button>
          </div>
          <div class="calendar-view-selector">
            <button class="calendar-view-btn active" data-view="month" onclick="setCalendarView('month')">Month</button>
            <button class="calendar-view-btn" data-view="week" onclick="setCalendarView('week')">Week</button>
            <button class="calendar-view-btn" data-view="day" onclick="setCalendarView('day')">Day</button>
          </div>
        </div>

        <div class="filters-bar">
          <select class="filter-select" id="calendarRegion" onchange="loadCalendar()">
            <option value="">All Regions</option>
            <option value="North">North</option>
            <option value="South">South</option>
          </select>
          <button class="btn btn-primary" onclick="loadCalendar()">üîÑ Refresh</button>
        </div>

        <div id="calendarGrid">
          <div style="text-align: center; padding: 40px;">
            <div class="spinner"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- All Bookings Section -->
    <div class="admin-section" id="bookings">
      <div class="filters-bar">
        <input type="text" class="filter-input" id="bookingSearch" placeholder="Search by name, email, address, reference...">
        <select class="filter-select" id="bookingRegion">
          <option value="">All Regions</option>
          <option value="North">North</option>
          <option value="South">South</option>
        </select>
        <select class="filter-select" id="bookingStatus">
          <option value="">All Status</option>
          <option value="Booked">Booked</option>
          <option value="Cancelled">Cancelled</option>
        </select>
        <button class="btn btn-primary" onclick="loadBookings()">üîç Search</button>
      </div>

      <div class="calendar-container" id="bookingsContainer">
        <div style="text-align: center; padding: 40px;">
          <div class="spinner"></div>
        </div>
      </div>
    </div>

    <!-- Reserved Bookings Section -->
    <div class="admin-section" id="reserved">
      <div class="calendar-container" id="reservedContainer">
        <div style="text-align: center; padding: 40px;">
          <div class="spinner"></div>
        </div>
      </div>
    </div>

    <!-- Customers Section -->
    <div class="admin-section" id="customers">
      <div class="filters-bar">
        <input type="text" class="filter-input" id="customerSearch" placeholder="Search by name, email, company...">
        <button class="btn btn-primary" onclick="loadCustomers()">üîç Search</button>
      </div>

      <div class="calendar-container" id="customersContainer">
        <div style="text-align: center; padding: 40px;">
          <div class="spinner"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Booking Detail Modal -->
  <div class="modal" id="bookingModal" onclick="closeModal('bookingModal')">
    <div class="modal-dialog" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3 id="bookingModalTitle">Booking Details</h3>
        <button class="modal-close" onclick="closeModal('bookingModal')">&times;</button>
      </div>
      <div class="modal-body" id="bookingModalBody">
        <!-- Content will be populated by JavaScript -->
      </div>
    </div>
  </div>

  <!-- Customer Detail Modal -->
  <div class="modal" id="customerModal" onclick="closeModal('customerModal')">
    <div class="modal-dialog" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3 id="customerModalTitle">Customer Details</h3>
        <button class="modal-close" onclick="closeModal('customerModal')">&times;</button>
      </div>
      <div class="modal-body" id="customerModalBody">
        <!-- Content will be populated by JavaScript -->
      </div>
    </div>
  </div>

  <script>
// Global state
let currentView = 'month';
let currentDate = new Date();
let allBookings = [];
let allCustomers = [];
let currentBooking = null;

// UK REGIONS - All UK counties and regions
const UK_REGIONS = [
  'Cheshire', 'Cumbria', 'Greater Manchester', 'Lancashire', 'Merseyside',
  'County Durham', 'Northumberland', 'Tyne and Wear',
  'East Riding of Yorkshire', 'North Yorkshire', 'South Yorkshire', 'West Yorkshire',
  'Derbyshire', 'Leicestershire', 'Lincolnshire', 'Northamptonshire', 'Nottinghamshire', 'Rutland',
  'Herefordshire', 'Shropshire', 'Staffordshire', 'Warwickshire', 'West Midlands', 'Worcestershire',
  'Bedfordshire', 'Cambridgeshire', 'Essex', 'Hertfordshire', 'Norfolk', 'Suffolk',
  'Berkshire', 'Buckinghamshire', 'East Sussex', 'Hampshire', 'Isle of Wight', 'Kent', 'Oxfordshire', 'Surrey', 'West Sussex',
  'Bristol', 'Cornwall', 'Devon', 'Dorset', 'Gloucestershire', 'Somerset', 'Wiltshire',
  'Greater London',
  'Aberdeenshire', 'Angus', 'Argyll and Bute', 'City of Edinburgh', 'Clackmannanshire',
  'Dumfries and Galloway', 'Dundee City', 'East Ayrshire', 'East Dunbartonshire', 'East Lothian',
  'East Renfrewshire', 'Falkirk', 'Fife', 'Glasgow City', 'Highland', 'Inverclyde',
  'Midlothian', 'Moray', 'North Ayrshire', 'North Lanarkshire', 'Orkney Islands',
  'Perth and Kinross', 'Renfrewshire', 'Scottish Borders', 'Shetland Islands', 'South Ayrshire',
  'South Lanarkshire', 'Stirling', 'West Dunbartonshire', 'West Lothian', 'Western Isles',
  'Anglesey', 'Blaenau Gwent', 'Bridgend', 'Caerphilly', 'Cardiff', 'Carmarthenshire',
  'Ceredigion', 'Conwy', 'Denbighshire', 'Flintshire', 'Gwynedd', 'Merthyr Tydfil',
  'Monmouthshire', 'Neath Port Talbot', 'Newport', 'Pembrokeshire', 'Powys', 'Rhondda Cynon Taf',
  'Swansea', 'Torfaen', 'Vale of Glamorgan', 'Wrexham',
  'Antrim', 'Armagh', 'Down', 'Fermanagh', 'Londonderry', 'Tyrone'
].sort();

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  loadDashboardStats();
  loadCalendar();
  loadBookings();
  loadReservedBookings();
  loadCustomers();
});

// ===== NAVIGATION =====
function showSection(sectionId) {
  document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  
  document.getElementById(sectionId).classList.add('active');
  
  const navItem = [...document.querySelectorAll('.nav-item')].find(n => 
    n.getAttribute('onclick')?.includes(`showSection('${sectionId}')`)
  );
  if (navItem) navItem.classList.add('active');

  if (window.innerWidth <= 1024) {
    document.getElementById('adminSidebar').classList.remove('open');
  }
}

function toggleSidebar() {
  const sidebar = document.getElementById('adminSidebar');
  sidebar.classList.toggle('open');
  
  if (sidebar.classList.contains('open')) {
    document.addEventListener('click', closeSidebarOutside);
  } else {
    document.removeEventListener('click', closeSidebarOutside);
  }
}

function closeSidebarOutside(event) {
  const sidebar = document.getElementById('adminSidebar');
  const menuBtn = document.querySelector('.mobile-menu-btn');
  
  if (!sidebar.contains(event.target) && !menuBtn.contains(event.target)) {
    sidebar.classList.remove('open');
    document.removeEventListener('click', closeSidebarOutside);
  }
}

function closeModal(modalId) {
  document.getElementById(modalId).classList.remove('active');
  
  if (window.innerWidth <= 1024) {
    document.getElementById('adminSidebar')?.classList.remove('open');
  }
}

// ===== DASHBOARD STATS =====
async function loadDashboardStats() {
  try {
    const response = await fetch('/.netlify/functions/admin-bookings', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({})
    });

    const data = await response.json();
    
    if (data.success) {
      document.getElementById('totalBookings').textContent = data.stats.total;
      document.getElementById('upcomingBookings').textContent = data.stats.upcoming;
      document.getElementById('reservedBookings').textContent = data.stats.reserved;
    }

    const customersResponse = await fetch('/.netlify/functions/admin-users');
    const customersData = await customersResponse.json();
    
    if (customersData.success) {
      document.getElementById('totalCustomers').textContent = customersData.total;
    }

  } catch (error) {
    console.error('Error loading dashboard stats:', error);
  }
}

// ===== CALENDAR FUNCTIONS =====
function setCalendarView(view) {
  currentView = view;
  document.querySelectorAll('.calendar-view-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.view === view);
  });
  loadCalendar();
}

function previousPeriod() {
  if (currentView === 'month') {
    currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
  } else if (currentView === 'week') {
    currentDate = new Date(currentDate.getTime() - 7 * 24 * 60 * 60 * 1000);
  } else {
    currentDate = new Date(currentDate.getTime() - 24 * 60 * 60 * 1000);
  }
  loadCalendar();
}

function nextPeriod() {
  if (currentView === 'month') {
    currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
  } else if (currentView === 'week') {
    currentDate = new Date(currentDate.getTime() + 7 * 24 * 60 * 60 * 1000);
  } else {
    currentDate = new Date(currentDate.getTime() + 24 * 60 * 60 * 1000);
  }
  loadCalendar();
}

async function loadCalendar() {
  const grid = document.getElementById('calendarGrid');
  const currentEl = document.getElementById('calendarCurrent');
  const region = document.getElementById('calendarRegion')?.value || '';

  grid.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="spinner"></div></div>';

  try {
    let startDate, endDate;

    if (currentView === 'month') {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      startDate = new Date(year, month, 1).toISOString().split('T')[0];
      endDate = new Date(year, month + 1, 0).toISOString().split('T')[0];
      
      currentEl.textContent = currentDate.toLocaleDateString('en-GB', { month: 'long', year: 'numeric' });
    } else if (currentView === 'week') {
      const tempDate = new Date(currentDate);
      const day = tempDate.getDay();
      const diff = tempDate.getDate() - day + (day === 0 ? -6 : 1);
      const monday = new Date(tempDate.setDate(diff));
      const sunday = new Date(monday);
      sunday.setDate(monday.getDate() + 6);
      
      startDate = monday.toISOString().split('T')[0];
      endDate = sunday.toISOString().split('T')[0];
      
      currentEl.textContent = `Week of ${monday.toLocaleDateString('en-GB', { month: 'short', day: 'numeric' })} - ${sunday.toLocaleDateString('en-GB', { month: 'short', day: 'numeric', year: 'numeric' })}`;
    } else {
      startDate = currentDate.toISOString().split('T')[0];
      endDate = startDate;
      
      currentEl.textContent = currentDate.toLocaleDateString('en-GB', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
    }

    const response = await fetch('/.netlify/functions/admin-bookings', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ startDate, endDate, region })
    });

    const data = await response.json();

    if (data.success) {
      if (currentView === 'month') {
        renderMonthView(data.bookings);
      } else if (currentView === 'week') {
        renderWeekView(data.bookings);
      } else {
        renderDayView(data.bookings);
      }
    }

  } catch (error) {
    console.error('Error loading calendar:', error);
    grid.innerHTML = '<div style="text-align: center; padding: 40px; color: #ef4444;">Error loading calendar</div>';
  }
}

function renderMonthView(bookings) {
  const grid = document.getElementById('calendarGrid');
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  const daysInMonth = lastDay.getDate();
  const startingDayOfWeek = firstDay.getDay() || 7;

  let html = '<div class="calendar-grid month">';
  
  ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].forEach(day => {
    html += `<div class="calendar-day-header">${day}</div>`;
  });

  for (let i = 1; i < startingDayOfWeek; i++) {
    html += '<div class="calendar-day other-month"></div>';
  }

  for (let day = 1; day <= daysInMonth; day++) {
    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    const dayBookings = bookings.filter(b => b.fields['Date'] === dateStr);
    
    const today = new Date();
    const isToday = dateStr === today.toISOString().split('T')[0];
    
    html += `<div class="calendar-day ${isToday ? 'today' : ''}">`;
    html += `<div class="calendar-day-number">${day}</div>`;
    
    dayBookings.forEach(booking => {
      const statusClass = booking.fields['Payment Status'] === 'Reserved' ? 'reserved' : 
                          booking.fields['Booking Status'] === 'Cancelled' ? 'cancelled' : '';
      html += `<div class="calendar-booking ${statusClass}" onclick="viewBookingById('${booking.id}')">${booking.fields['Time']} ${booking.fields['Client Name']}</div>`;
    });
    
    html += '</div>';
  }

  html += '</div>';
  grid.innerHTML = html;
}

function renderWeekView(bookings) {
  const grid = document.getElementById('calendarGrid');
  grid.innerHTML = '<div style="padding: 40px; text-align: center;">Week view coming soon...</div>';
}

function renderDayView(bookings) {
  const grid = document.getElementById('calendarGrid');
  grid.innerHTML = '<div style="padding: 40px; text-align: center;">Day view coming soon...</div>';
}

// ===== BOOKINGS FUNCTIONS =====
async function loadBookings() {
  const container = document.getElementById('bookingsContainer');
  container.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="spinner"></div></div>';

  try {
    const search = document.getElementById('bookingSearch')?.value || '';
    const region = document.getElementById('bookingRegion')?.value || '';
    const status = document.getElementById('bookingStatus')?.value || '';

    const response = await fetch('/.netlify/functions/admin-bookings', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ region, status })
    });

    const data = await response.json();

    if (data.success) {
      allBookings = data.bookings;
      renderBookingsTable(allBookings, search);
    }

  } catch (error) {
    console.error('Error loading bookings:', error);
    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ef4444;">Error loading bookings</div>';
  }
}

async function loadReservedBookings() {
  const container = document.getElementById('reservedContainer');
  container.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="spinner"></div></div>';

  try {
    const response = await fetch('/.netlify/functions/admin-bookings', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ paymentStatus: 'Reserved' })
    });

    const data = await response.json();

    if (data.success) {
      renderBookingsTable(data.bookings, '', 'reservedContainer');
    }

  } catch (error) {
    console.error('Error loading reserved bookings:', error);
    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ef4444;">Error loading reserved bookings</div>';
  }
}

function renderBookingsTable(bookings, search = '', containerId = 'bookingsContainer') {
  const container = document.getElementById(containerId);
  
  let filtered = bookings;
  if (search) {
    const term = search.toLowerCase();
    filtered = bookings.filter(b => 
      (b.fields['Client Name'] || '').toLowerCase().includes(term) ||
      (b.fields['Client Email'] || '').toLowerCase().includes(term) ||
      (b.fields['Property Address'] || '').toLowerCase().includes(term) ||
      (b.fields['Booking Reference'] || '').toLowerCase().includes(term)
    );
  }

  if (filtered.length === 0) {
    container.innerHTML = '<div style="text-align: center; padding: 40px;">No bookings found</div>';
    return;
  }

  let html = `
    <table class="data-table">
      <thead>
        <tr>
          <th>Reference</th>
          <th>Date & Time</th>
          <th>Client</th>
          <th>Address</th>
          <th>Service</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
  `;

  filtered.forEach(booking => {
    html += `
      <tr>
        <td data-label="Reference"><strong>${booking.fields['Booking Reference']}</strong></td>
        <td data-label="Date & Time">${booking.fields['Date']}<br>${booking.fields['Time']}</td>
        <td data-label="Client">
          ${booking.fields['Client Name']}<br>
          <small style="color: #64748b;">${booking.fields['Client Email']}</small>
        </td>
        <td data-label="Address">${booking.fields['Property Address'] || '-'}</td>
        <td data-label="Service">${booking.fields['Service Name'] || '-'}</td>
        <td data-label="Status">
          <span class="status-badge status-${(booking.fields['Payment Status'] || '').toLowerCase()}">
            ${booking.fields['Payment Status'] || '-'}
          </span>
        </td>
        <td data-label="Actions">
          <button class="btn btn-primary btn-small" onclick="viewBookingById('${booking.id}')">
            View
          </button>
        </td>
      </tr>
    `;
  });

  html += '</tbody></table>';
  container.innerHTML = html;
}

// ===== VIEW BOOKING WITH ADMIN ACTIONS =====
function viewBookingById(bookingId) {
  const booking = allBookings.find(b => b.id === bookingId);
  if (!booking) {
    alert('Booking not found');
    return;
  }
  viewBooking(booking);
}

function viewBooking(booking) {
  currentBooking = booking;
  const modal = document.getElementById('bookingModal');
  const title = document.getElementById('bookingModalTitle');
  const body = document.getElementById('bookingModalBody');

  title.textContent = `Booking ${booking.fields['Booking Reference']}`;

  const driveTimeSection = booking.driveTimeInfo ? `
    <div style="background: #f0f9ff; border: 2px solid #3b82f6; border-radius: 12px; padding: 16px; margin: 16px 0;">
      <h4 style="margin: 0 0 12px 0; color: #1e40af;">üöó Drive Time Information</h4>
      <div class="detail-item">
        <span class="detail-label">Drive Time</span>
        <span class="detail-value">${booking.driveTimeInfo.driveTimeFormatted}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Buffer Time</span>
        <span class="detail-value">
          ${booking.driveTimeInfo.bufferTime.available} min 
          (${booking.driveTimeInfo.bufferTime.sufficient ? '‚úì Sufficient' : '‚ö†Ô∏è Tight'})
        </span>
      </div>
    </div>
  ` : '';

  const isCancelled = booking.fields['Booking Status'] === 'Cancelled';
  const isReserved = booking.fields['Payment Status'] === 'Reserved' || booking.fields['Payment Status'] === 'Pending';

  body.innerHTML = `
    <div class="detail-item">
      <span class="detail-label">Reference</span>
      <span class="detail-value">${booking.fields['Booking Reference']}</span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Date & Time</span>
      <span class="detail-value">${booking.fields['Date']} at ${booking.fields['Time']}</span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Client Name</span>
      <span class="detail-value">${booking.fields['Client Name']}</span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Client Email</span>
      <span class="detail-value">${booking.fields['Client Email']}</span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Property Address</span>
      <span class="detail-value">${booking.fields['Property Address'] || '-'}</span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Service</span>
      <span class="detail-value">${booking.fields['Service Name'] || '-'}</span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Total Price</span>
      <span class="detail-value">¬£${(booking.fields['Total Price'] || 0).toFixed(2)}</span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Payment Status</span>
      <span class="detail-value">
        <span class="status-badge status-${(booking.fields['Payment Status'] || '').toLowerCase()}">
          ${booking.fields['Payment Status'] || '-'}
        </span>
      </span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Booking Status</span>
      <span class="detail-value">
        <span class="status-badge status-${isCancelled ? 'cancelled' : 'active'}">
          ${booking.fields['Booking Status'] || 'Booked'}
        </span>
      </span>
    </div>
    
    ${driveTimeSection}
    
    ${!isCancelled ? `
      <div style="margin-top: 24px; padding-top: 24px; border-top: 2px solid #e2e8f0;">
        
        <div style="margin-bottom: 20px; padding: 16px; background: #f8fafc; border-radius: 8px;">
          <label style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;">
            <span style="font-weight: 600; color: #64748b; font-size: 14px;">üìß Send Email Notifications</span>
            <span class="toggle-switch">
              <input type="checkbox" id="sendEmailToggle-${booking.id}" checked>
              <span class="toggle-slider"></span>
            </span>
          </label>
        </div>

        <div class="action-buttons-grid">
          
          ${isReserved ? `
            <button class="btn btn-success" onclick="chargeReservedBooking('${booking.id}')" style="width: 100%; justify-content: center;">
              üí≥ Charge Card
            </button>
          ` : ''}
          
          <button class="btn btn-primary" onclick="showAdminReschedule('${booking.id}')" style="width: 100%; justify-content: center;">
            üìÖ Reschedule
          </button>
          
          <button class="btn btn-secondary" onclick="showModifyService('${booking.id}')" style="width: 100%; justify-content: center;">
            ‚úèÔ∏è Modify Service
          </button>
          
          <button class="btn btn-danger" onclick="showAdminCancel('${booking.id}')" style="width: 100%; justify-content: center;">
            ‚ùå Cancel
          </button>
        </div>

        <div class="info-box" style="margin-top: 16px;">
          <strong>‚ÑπÔ∏è Admin Actions:</strong> These bypass normal restrictions and can modify any booking.
        </div>
      </div>
    ` : `
      <div style="margin-top: 24px; padding: 16px; background: #fee2e2; border: 2px solid #ef4444; border-radius: 12px; text-align: center; color: #991b1b;">
        <strong>‚ùå This booking has been cancelled</strong>
      </div>
    `}
  `;

  modal.classList.add('active');
}

// ===== ADMIN ACTIONS =====

// Charge Reserved Booking
async function chargeReservedBooking(bookingId) {
  const booking = allBookings.find(b => b.id === bookingId) || currentBooking;
  if (!booking) return alert('Booking data not found');

  if (!confirm(`Charge reserved booking?\n\nClient: ${booking.fields['Client Name']}\nAmount: ¬£${(booking.fields['Total Price'] || 0).toFixed(2)}`)) return;
  
  try {
    const response = await fetch('/.netlify/functions/charge-card', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ bookingId })
    });

    const data = await response.json();

    if (data.success) {
      alert(`‚úÖ Payment charged!\n\nAmount: ¬£${data.amount.toFixed(2)}\n\nConfirmation email sent.`);
      closeModal('bookingModal');
      loadBookings();
      loadDashboardStats();
      loadCalendar();
    } else {
      alert(`‚ùå Error: ${data.error || 'Failed to charge card'}`);
    }
  } catch (error) {
    console.error('Error:', error);
    alert('‚ùå Failed to charge card.');
  }
}

// Admin Reschedule
function showAdminReschedule(bookingId) {
  const booking = allBookings.find(b => b.id === bookingId) || currentBooking;
  if (!booking) return;
  
  const sendEmail = document.getElementById(`sendEmailToggle-${bookingId}`)?.checked ?? true;
  
  const newDate = prompt('Enter new date (YYYY-MM-DD):', booking.fields['Date']);
  if (!newDate || !newDate.match(/^\d{4}-\d{2}-\d{2}$/)) return;
  
  const newTime = prompt('Enter new time (HH:MM):', booking.fields['Time']);
  if (!newTime || !newTime.match(/^\d{2}:\d{2}$/)) return;
  
  if (!confirm(`Reschedule to ${newDate} at ${newTime}?\n\nSend email: ${sendEmail ? 'Yes' : 'No'}`)) return;
  
  adminRescheduleBooking(bookingId, newDate, newTime, sendEmail);
}

async function adminRescheduleBooking(bookingId, newDate, newTime, sendEmail) {
  try {
    const response = await fetch('/.netlify/functions/admin-reschedule-booking', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ bookingId, newDate, newTime, sendEmail })
    });

    const data = await response.json();

    if (data.success) {
      alert(`‚úÖ Rescheduled!\n\n${newDate} at ${newTime}\n\n${data.emailSent ? '‚úâÔ∏è Email sent' : 'üîï Silent'}`);
      closeModal('bookingModal');
      loadBookings();
      loadCalendar();
    } else {
      alert(`‚ùå Error: ${data.error}`);
    }
  } catch (error) {
    alert('‚ùå Failed to reschedule.');
  }
}

// Admin Cancel
function showAdminCancel(bookingId) {
  const booking = allBookings.find(b => b.id === bookingId) || currentBooking;
  if (!booking) return;
  
  const sendEmail = document.getElementById(`sendEmailToggle-${bookingId}`)?.checked ?? true;
  const reason = prompt('Reason:') || 'Admin cancelled';
  
  if (!confirm(`Cancel booking?\n\nClient: ${booking.fields['Client Name']}\nReason: ${reason}\n\nSend email: ${sendEmail ? 'Yes' : 'No'}`)) return;
  
  adminCancelBooking(bookingId, reason, sendEmail);
}

async function adminCancelBooking(bookingId, reason, sendEmail) {
  try {
    const response = await fetch('/.netlify/functions/admin-cancel-booking', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ bookingId, reason, sendEmail })
    });

    const data = await response.json();

    if (data.success) {
      let msg = `‚úÖ Cancelled!\n\n`;
      if (data.cancellationCharge > 0) msg += `Fee: ¬£${data.cancellationCharge.toFixed(2)}\n`;
      if (data.refundProcessed) msg += `Refund: ¬£${data.refundAmount.toFixed(2)}\n`;
      msg += `\n${data.emailSent ? '‚úâÔ∏è Email sent' : 'üîï Silent'}`;
      alert(msg);
      closeModal('bookingModal');
      loadBookings();
      loadCalendar();
    } else {
      alert(`‚ùå Error: ${data.error}`);
    }
  } catch (error) {
    alert('‚ùå Failed to cancel.');
  }
}

// Modify Service
function showModifyService(bookingId) {
  const booking = allBookings.find(b => b.id === bookingId) || currentBooking;
  if (!booking) return;
  
  const sendEmail = document.getElementById(`sendEmailToggle-${bookingId}`)?.checked ?? true;
  
  const newServiceName = prompt('New service name:');
  if (!newServiceName) return;
  
  const newPrice = parseFloat(prompt('New base price (¬£):'));
  if (isNaN(newPrice)) return;
  
  const newDuration = parseInt(prompt('Duration (mins):', '60'));
  if (isNaN(newDuration)) return;
  
  if (!confirm(`Change service?\n\nNew: ${newServiceName} (¬£${newPrice})\n\nSend email: ${sendEmail ? 'Yes' : 'No'}`)) return;
  
  adminModifyService(bookingId, newServiceName, newPrice, newDuration, sendEmail);
}

async function adminModifyService(bookingId, newServiceName, newServicePrice, newServiceDuration, sendEmail) {
  try {
    const response = await fetch('/.netlify/functions/admin-modify-service', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        bookingId,
        newServiceId: newServiceName.toLowerCase().replace(/\s+/g, '-'),
        newServiceName,
        newServicePrice,
        newServiceDuration,
        sendEmail
      })
    });

    const data = await response.json();

    if (data.success) {
      alert(`‚úÖ Modified!\n\nNew: ${data.newService} (¬£${data.newPrice.toFixed(2)})\n\n${data.emailSent ? '‚úâÔ∏è Email sent' : 'üîï Silent'}`);
      closeModal('bookingModal');
      loadBookings();
    } else {
      alert(`‚ùå Error: ${data.error}`);
    }
  } catch (error) {
    alert('‚ùå Failed to modify service.');
  }
}

// ===== CUSTOMERS =====
async function loadCustomers() {
  const container = document.getElementById('customersContainer');
  container.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="spinner"></div></div>';

  try {
    const response = await fetch('/.netlify/functions/admin-users');
    const data = await response.json();

    if (data.success) {
      allCustomers = data.users;
      renderCustomersTable(allCustomers);
    }

  } catch (error) {
    console.error('Error loading customers:', error);
    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ef4444;">Error loading customers</div>';
  }
}

function renderCustomersTable(customers) {
  const container = document.getElementById('customersContainer');
  const search = document.getElementById('customerSearch')?.value || '';

  let filtered = customers;
  if (search) {
    const term = search.toLowerCase();
    filtered = customers.filter(c => 
      (c.fields['Name'] || '').toLowerCase().includes(term) ||
      (c.fields['Email'] || '').toLowerCase().includes(term) ||
      (c.fields['Company'] || '').toLowerCase().includes(term)
    );
  }

  if (filtered.length === 0) {
    container.innerHTML = '<div style="text-align: center; padding: 40px;">No customers found</div>';
    return;
  }

  let html = `
    <table class="data-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Company</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
  `;

  filtered.forEach(customer => {
    html += `
      <tr>
        <td data-label="Name"><strong>${customer.fields['Name']}</strong></td>
        <td data-label="Email">${customer.fields['Email']}</td>
        <td data-label="Company">${customer.fields['Company'] || '-'}</td>
        <td data-label="Status">
          <span class="status-badge status-${(customer.fields['Account Status'] || '').toLowerCase()}">
            ${customer.fields['Account Status'] || '-'}
          </span>
        </td>
        <td data-label="Actions">
          <button class="btn btn-primary btn-small" onclick="viewCustomerById('${customer.id}')">
            View
          </button>
        </td>
      </tr>
    `;
  });

  html += '</tbody></table>';
  container.innerHTML = html;
}

function viewCustomerById(customerId) {
  const customer = allCustomers.find(c => c.id === customerId);
  if (!customer) {
    alert('Customer not found');
    return;
  }
  
  const modal = document.getElementById('customerModal');
  const title = document.getElementById('customerModalTitle');
  const body = document.getElementById('customerModalBody');

  title.textContent = customer.fields['Name'];

  body.innerHTML = `
    <div class="detail-item">
      <span class="detail-label">Name</span>
      <span class="detail-value">${customer.fields['Name']}</span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Email</span>
      <span class="detail-value">${customer.fields['Email']}</span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Company</span>
      <span class="detail-value">${customer.fields['Company'] || '-'}</span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Phone</span>
      <span class="detail-value">${customer.fields['Phone'] || '-'}</span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Account Status</span>
      <span class="detail-value">
        <span class="status-badge status-${(customer.fields['Account Status'] || '').toLowerCase()}">
          ${customer.fields['Account Status'] || '-'}
        </span>
      </span>
    </div>
    <div class="detail-item">
      <span class="detail-label">Total Bookings</span>
      <span class="detail-value">${customer.fields['Total Bookings'] || 0}</span>
    </div>
  `;

  modal.classList.add('active');
}

// Real-time search
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('bookingSearch')?.addEventListener('input', (e) => {
    renderBookingsTable(allBookings, e.target.value);
  });

  document.getElementById('customerSearch')?.addEventListener('input', () => {
    renderCustomersTable(allCustomers);
  });
});
  </script>
</body>
</html>