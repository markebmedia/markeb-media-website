<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Bookings – Markeb Media</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --blue: #3b82f6;
      --blue-dark: #2563eb;
      --blue-light: #eff6ff;
      --blue-mid: #dbeafe;
      --slate-900: #0f172a;
      --slate-700: #334155;
      --slate-500: #64748b;
      --slate-300: #cbd5e1;
      --slate-100: #f1f5f9;
      --slate-50: #f8fafc;
      --white: #ffffff;
      --green: #10b981;
      --green-light: #f0fdf4;
      --amber: #f59e0b;
      --amber-light: #fef3c7;
      --red: #ef4444;
      --red-light: #fef2f2;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--slate-50);
      color: var(--slate-900);
      min-height: 100vh;
    }

    /* NAV */
    .nav {
      background: var(--white);
      border-bottom: 1px solid var(--slate-300);
      padding: 0 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 64px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .nav-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 17px;
      color: var(--slate-900);
      text-decoration: none;
    }
    .nav-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .nav-user {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
      color: var(--slate-700);
    }
    .nav-avatar {
      width: 34px; height: 34px;
      background: linear-gradient(135deg, var(--blue), var(--blue-dark));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 13px;
      font-weight: 700;
    }
    .nav-logout {
      font-size: 13px;
      color: var(--slate-500);
      text-decoration: none;
      padding: 6px 12px;
      border-radius: 6px;
      transition: background 0.15s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .nav-logout:hover { background: var(--slate-100); }

    /* MAIN */
    .main {
      max-width: 960px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    /* HEADER */
    .page-header {
      margin-bottom: 32px;
    }
    .page-header h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--slate-900);
      margin-bottom: 4px;
    }
    .page-header p {
      font-size: 15px;
      color: var(--slate-500);
    }

    /* STATS ROW */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }
    .stat-card {
      background: var(--white);
      border: 1px solid var(--slate-300);
      border-radius: 12px;
      padding: 20px 24px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .stat-icon {
      width: 40px; height: 40px;
      border-radius: 10px;
      background: var(--slate-100);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .stat-icon i { width: 20px; height: 20px; color: var(--slate-500); }
    .stat-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--slate-500);
      margin-bottom: 4px;
    }
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--slate-900);
      font-family: 'DM Mono', monospace;
    }
    .stat-card.highlight { border-color: var(--blue); background: var(--blue-light); }
    .stat-card.highlight .stat-icon { background: var(--blue-mid); }
    .stat-card.highlight .stat-icon i { color: var(--blue); }
    .stat-card.highlight .stat-value { color: var(--blue-dark); }

    /* VIEW TOGGLE */
    .view-toggle {
      display: flex;
      align-items: center;
      gap: 4px;
      background: var(--slate-100);
      border-radius: 10px;
      padding: 4px;
      margin-bottom: 20px;
      width: fit-content;
    }
    .view-btn {
      display: flex;
      align-items: center;
      gap: 7px;
      padding: 8px 16px;
      border-radius: 7px;
      border: none;
      background: transparent;
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 600;
      color: var(--slate-500);
      cursor: pointer;
      transition: all 0.15s;
    }
    .view-btn i { width: 15px; height: 15px; }
    .view-btn:hover { color: var(--slate-900); }
    .view-btn.active {
      background: var(--white);
      color: var(--blue);
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }

    /* FILTERS */
    .filters {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .filter-btn {
      padding: 7px 16px;
      border-radius: 8px;
      border: 1px solid var(--slate-300);
      background: var(--white);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 500;
      color: var(--slate-700);
      cursor: pointer;
      transition: all 0.15s;
    }
    .filter-btn:hover { border-color: var(--blue); color: var(--blue); }
    .filter-btn.active { background: var(--blue); border-color: var(--blue); color: var(--white); }

    .search-wrap {
      margin-left: auto;
      position: relative;
    }
    .search-wrap i {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 15px; height: 15px;
      color: var(--slate-500);
      pointer-events: none;
    }
    .filter-search {
      padding: 7px 14px 7px 32px;
      border-radius: 8px;
      border: 1px solid var(--slate-300);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      color: var(--slate-900);
      outline: none;
      width: 220px;
      transition: border 0.15s;
    }
    .filter-search:focus { border-color: var(--blue); }

    /* BOOKING CARDS */
    .bookings-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .booking-card {
      background: var(--white);
      border: 1px solid var(--slate-300);
      border-radius: 12px;
      overflow: hidden;
      transition: box-shadow 0.15s, border-color 0.15s;
      cursor: pointer;
    }
    .booking-card:hover {
      border-color: var(--blue);
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.1);
    }
    .booking-card.expanded { border-color: var(--blue); }

    .booking-card-header {
      padding: 18px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .booking-status-dot {
      width: 10px; height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .status-upcoming { background: var(--green); }
    .status-today { background: var(--blue); box-shadow: 0 0 0 3px rgba(59,130,246,0.2); }
    .status-past { background: var(--slate-300); }
    .status-cancelled { background: var(--red); }

    .booking-main { flex: 1; min-width: 0; }
    .booking-ref {
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      font-weight: 500;
      color: var(--slate-500);
      margin-bottom: 2px;
    }
    .booking-address {
      font-size: 15px;
      font-weight: 600;
      color: var(--slate-900);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .booking-service {
      font-size: 13px;
      color: var(--slate-500);
      margin-top: 2px;
    }

    .booking-meta {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      flex-shrink: 0;
    }
    .booking-date { font-size: 13px; font-weight: 600; color: var(--slate-700); }
    .booking-time { font-size: 13px; color: var(--slate-500); }

    .booking-badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .badge-today { background: var(--blue-mid); color: var(--blue-dark); }
    .badge-upcoming { background: var(--green-light); color: var(--green); }
    .badge-past { background: var(--slate-100); color: var(--slate-500); }
    .badge-cancelled { background: var(--red-light); color: var(--red); }

    .booking-chevron {
      color: var(--slate-300);
      transition: transform 0.2s;
      flex-shrink: 0;
    }
    .booking-chevron i { width: 18px; height: 18px; }
    .booking-card.expanded .booking-chevron { transform: rotate(180deg); color: var(--blue); }

    /* EXPANDED DETAILS */
    .booking-details {
      display: none;
      border-top: 1px solid var(--slate-100);
      padding: 20px;
      background: var(--slate-50);
    }
    .booking-card.expanded .booking-details { display: block; }

    .details-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }
    .detail-item.full { grid-column: 1 / -1; }
    .detail-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--slate-500);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .detail-label i { width: 12px; height: 12px; }
    .detail-value {
      font-size: 14px;
      font-weight: 500;
      color: var(--slate-900);
    }

    .access-alert {
      background: var(--amber-light);
      border: 1px solid var(--amber);
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 12px;
      font-size: 13px;
      color: #92400e;
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }
    .access-alert i { width: 16px; height: 16px; flex-shrink: 0; margin-top: 1px; }
    .access-alert strong { display: block; margin-bottom: 2px; }

    .addons-list { display: flex; flex-wrap: wrap; gap: 6px; }
    .addon-tag {
      background: var(--blue-light);
      border: 1px solid var(--blue-mid);
      color: var(--blue-dark);
      border-radius: 6px;
      padding: 3px 10px;
      font-size: 12px;
      font-weight: 500;
    }

    .notes-box {
      background: var(--white);
      border: 1px solid var(--slate-300);
      border-radius: 8px;
      padding: 12px 14px;
      font-size: 13px;
      color: var(--slate-700);
      line-height: 1.5;
    }

    /* EMPTY / LOADING */
    .state-box {
      text-align: center;
      padding: 60px 20px;
      color: var(--slate-500);
    }
    .state-box i { width: 40px; height: 40px; margin-bottom: 12px; color: var(--slate-300); }
    .state-box h3 { font-size: 16px; font-weight: 600; color: var(--slate-700); margin-bottom: 6px; }
    .state-box p { font-size: 14px; }

    .spinner {
      width: 32px; height: 32px;
      border: 3px solid var(--blue-mid);
      border-top-color: var(--blue);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .booking-card.today-card { border-color: var(--blue); background: var(--blue-light); }
    .booking-card.today-card .booking-card-header { background: var(--blue-light); }

    .section-label {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--slate-500);
      margin: 24px 0 10px;
      padding: 0 2px;
    }
    .section-label:first-child { margin-top: 0; }

    /* ===== CALENDAR VIEW ===== */
    #calendarView { display: none; }

    .cal-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      gap: 12px;
    }
    .cal-nav {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .cal-nav-btn {
      width: 34px; height: 34px;
      border-radius: 8px;
      border: 1px solid var(--slate-300);
      background: var(--white);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.15s;
      color: var(--slate-700);
    }
    .cal-nav-btn:hover { border-color: var(--blue); color: var(--blue); }
    .cal-nav-btn i { width: 16px; height: 16px; }
    .cal-month-label {
      font-size: 17px;
      font-weight: 700;
      color: var(--slate-900);
      min-width: 180px;
      text-align: center;
    }
    .cal-today-btn {
      padding: 7px 14px;
      border-radius: 8px;
      border: 1px solid var(--slate-300);
      background: var(--white);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 600;
      color: var(--slate-700);
      cursor: pointer;
      transition: all 0.15s;
    }
    .cal-today-btn:hover { border-color: var(--blue); color: var(--blue); }

    .cal-grid {
      background: var(--white);
      border: 1px solid var(--slate-300);
      border-radius: 12px;
      overflow: hidden;
    }
    .cal-header-row {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      background: var(--slate-50);
      border-bottom: 1px solid var(--slate-300);
    }
    .cal-header-cell {
      padding: 10px 0;
      text-align: center;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--slate-500);
    }
    .cal-body {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }
    .cal-cell {
      min-height: 100px;
      border-right: 1px solid var(--slate-100);
      border-bottom: 1px solid var(--slate-100);
      padding: 8px;
      position: relative;
      transition: background 0.1s;
    }
    .cal-cell:nth-child(7n) { border-right: none; }
    .cal-cell.other-month { background: var(--slate-50); }
    .cal-cell.other-month .cal-day-num { color: var(--slate-300); }
    .cal-cell.is-today { background: var(--blue-light); }
    .cal-cell.has-bookings { cursor: pointer; }
    .cal-cell.has-bookings:hover { background: #f0f7ff; }

    .cal-day-num {
      font-size: 13px;
      font-weight: 600;
      color: var(--slate-700);
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      border-radius: 50%;
    }
    .cal-cell.is-today .cal-day-num {
      background: var(--blue);
      color: var(--white);
    }

    .cal-event {
      font-size: 11px;
      font-weight: 600;
      padding: 3px 6px;
      border-radius: 4px;
      margin-bottom: 3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
      transition: opacity 0.1s;
    }
    .cal-event:hover { opacity: 0.8; }
    .cal-event.ev-today { background: var(--blue-mid); color: var(--blue-dark); }
    .cal-event.ev-upcoming { background: #dcfce7; color: #166534; }
    .cal-event.ev-past { background: var(--slate-100); color: var(--slate-500); }
    .cal-event.ev-cancelled { background: var(--red-light); color: var(--red); text-decoration: line-through; }

    .cal-more {
      font-size: 10px;
      font-weight: 600;
      color: var(--slate-500);
      padding: 2px 4px;
      cursor: pointer;
    }
    .cal-more:hover { color: var(--blue); }

    /* BOOKING DETAIL PANEL (shown on calendar event click) */
    .cal-detail-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.4);
      z-index: 500;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .cal-detail-overlay.open { display: flex; }
    .cal-detail-panel {
      background: var(--white);
      border-radius: 16px;
      max-width: 480px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
      animation: panelIn 0.2s ease-out;
    }
    @keyframes panelIn {
      from { opacity: 0; transform: translateY(12px) scale(0.97); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }
    .cal-detail-header {
      padding: 20px 20px 16px;
      border-bottom: 1px solid var(--slate-100);
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
    }
    .cal-detail-header h3 {
      font-size: 16px;
      font-weight: 700;
      color: var(--slate-900);
      margin-bottom: 2px;
    }
    .cal-detail-header p {
      font-size: 13px;
      color: var(--slate-500);
    }
    .cal-detail-close {
      width: 30px; height: 30px;
      border-radius: 6px;
      border: 1px solid var(--slate-300);
      background: var(--white);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      flex-shrink: 0;
      transition: all 0.15s;
      color: var(--slate-500);
    }
    .cal-detail-close:hover { border-color: var(--red); color: var(--red); }
    .cal-detail-close i { width: 14px; height: 14px; }
    .cal-detail-body { padding: 20px; }
    .cal-detail-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .cal-detail-grid .detail-item.full { grid-column: 1 / -1; }

    /* ===== TABLET (≤768px) ===== */
    @media (max-width: 768px) {
      .main { padding: 24px 16px; }

      /* Nav */
      .nav { padding: 0 16px; }
      .nav-logo span { display: none; }

      /* Header */
      .page-header { margin-bottom: 20px; }
      .page-header h1 { font-size: 22px; }

      /* Stats */
      .stats-row { gap: 10px; margin-bottom: 20px; }
      .stat-card { padding: 14px 16px; gap: 10px; }
      .stat-icon { width: 34px; height: 34px; }
      .stat-value { font-size: 24px; }
      .stat-label { font-size: 10px; }

      /* View toggle */
      .view-toggle { margin-bottom: 16px; }

      /* Filters — scrollable horizontal row, no wrapping */
      .filters {
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        gap: 6px;
        padding-bottom: 4px;
        margin-bottom: 16px;
      }
      .filters::-webkit-scrollbar { display: none; }
      .filter-btn { white-space: nowrap; flex-shrink: 0; padding: 8px 14px; min-height: 40px; }
      .search-wrap { flex-shrink: 0; min-width: 180px; margin-left: 0; }
      .filter-search { width: 180px; }

      /* List cards */
      .booking-card-header { padding: 14px 14px; gap: 10px; }
      .booking-address { font-size: 14px; }
      .booking-details { padding: 14px; }
      .details-grid { grid-template-columns: 1fr; gap: 10px; }

      /* Calendar controls */
      .cal-controls { margin-bottom: 14px; }
      .cal-month-label { font-size: 15px; min-width: 140px; }

      /* Calendar cells — compact but readable */
      .cal-cell { min-height: 72px; padding: 5px 4px; }
      .cal-day-num { font-size: 12px; width: 22px; height: 22px; margin-bottom: 4px; }
      .cal-header-cell { font-size: 10px; padding: 8px 0; }

      /* Events — show dot + time only */
      .cal-event {
        font-size: 10px;
        padding: 2px 5px;
        margin-bottom: 2px;
      }

      /* Detail panel — bottom sheet on tablet */
      .cal-detail-overlay { align-items: flex-end; padding: 0; }
      .cal-detail-panel {
        max-width: 100%;
        border-radius: 16px 16px 0 0;
        max-height: 85vh;
        animation: sheetUp 0.25s ease-out;
      }
      @keyframes sheetUp {
        from { transform: translateY(100%); }
        to   { transform: translateY(0); }
      }
      .cal-detail-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
    }

    /* ===== MOBILE (≤480px) ===== */
    @media (max-width: 480px) {
      .main { padding: 16px 12px; }

      /* Nav — tighter */
      .nav { height: 56px; padding: 0 14px; }
      .nav-avatar { width: 30px; height: 30px; font-size: 11px; }
      .nav-logout-text { display: none; } /* hide "Sign out" text, keep icon */

      /* Stats — single row, minimal */
      .stats-row { grid-template-columns: repeat(3, 1fr); gap: 8px; }
      .stat-icon { display: none; }
      .stat-card { padding: 12px 10px; border-radius: 10px; }
      .stat-value { font-size: 22px; }
      .stat-label { font-size: 10px; }

      /* Booking cards */
      .booking-card-header { padding: 12px 12px; gap: 8px; }
      .booking-ref { font-size: 10px; }
      .booking-address { font-size: 13px; }
      .booking-service { font-size: 12px; }
      .booking-date { font-size: 12px; }
      .booking-time { font-size: 12px; }
      .booking-badge { font-size: 10px; padding: 2px 8px; }
      .booking-details { padding: 12px; }

      /* Calendar — ultra compact */
      .cal-cell { min-height: 52px; padding: 3px; }
      .cal-day-num { font-size: 11px; width: 20px; height: 20px; margin-bottom: 2px; }
      .cal-header-cell { font-size: 9px; padding: 6px 0; letter-spacing: 0; }

      /* On phones: show coloured dot instead of text label */
      .cal-event {
        height: 7px;
        padding: 0;
        border-radius: 3px;
        font-size: 0; /* hide text */
        margin-bottom: 2px;
        min-width: 100%;
      }
      .cal-more { font-size: 9px; }

      /* Calendar controls */
      .cal-month-label { font-size: 13px; min-width: 110px; }
      .cal-nav-btn { width: 30px; height: 30px; }
      .cal-today-btn { padding: 6px 10px; font-size: 12px; }

      /* Bottom sheet detail panel */
      .cal-detail-overlay { align-items: flex-end; padding: 0; }
      .cal-detail-panel {
        max-width: 100%;
        border-radius: 16px 16px 0 0;
        max-height: 90vh;
        animation: sheetUp 0.25s ease-out;
      }
      .cal-detail-header { padding: 16px 16px 12px; }
      .cal-detail-header h3 { font-size: 14px; }
      .cal-detail-body { padding: 14px; }
      .cal-detail-grid { grid-template-columns: 1fr; gap: 10px; }

      /* Prevent iOS zoom on inputs */
      input, select, textarea { font-size: 16px !important; }

      /* Bigger tap targets */
      .filter-btn { min-height: 44px; }
      .view-btn { min-height: 40px; padding: 8px 14px; }
      .cal-nav-btn { min-height: 44px; min-width: 44px; }
    }

    /* Touch: ensure tap targets everywhere */
    @media (pointer: coarse) {
      .cal-event { min-height: 22px; font-size: 10px; padding: 3px 5px; }
      .cal-cell { cursor: default; }
    }

    /* ===== COLOUR LEGEND (mobile calendar) ===== */
    .cal-legend {
      display: none;
      gap: 12px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    .cal-legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      font-weight: 600;
      color: var(--slate-500);
    }
    .cal-legend-dot {
      width: 10px; height: 10px;
      border-radius: 2px;
      flex-shrink: 0;
    }
    @media (max-width: 480px) {
      .cal-legend { display: flex; }
    }
  </style>
</head>
<body>

<nav class="nav">
  <a href="/" class="nav-logo">
    <i data-lucide="camera" style="width:22px;height:22px;color:#3b82f6;"></i>
    Markeb Media
  </a>
  <div class="nav-right">
    <div class="nav-user">
      <div class="nav-avatar" id="navAvatar">JH</div>
      <span id="navName">Loading…</span>
    </div>
    <a href="#" class="nav-logout" onclick="handleLogout()">
      <i data-lucide="log-out" style="width:14px;height:14px;"></i>
      <span class="nav-logout-text">Sign out</span>
    </a>
  </div>
</nav>

<main class="main">

  <div class="page-header">
    <h1>My Bookings</h1>
    <p id="pageSubtitle">All shoots assigned to you</p>
  </div>

  <div class="stats-row">
    <div class="stat-card highlight">
      <div class="stat-icon"><i data-lucide="sun"></i></div>
      <div>
        <div class="stat-label">Today</div>
        <div class="stat-value" id="statToday">—</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i data-lucide="calendar"></i></div>
      <div>
        <div class="stat-label">Upcoming</div>
        <div class="stat-value" id="statUpcoming">—</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i data-lucide="check-circle"></i></div>
      <div>
        <div class="stat-label">Completed</div>
        <div class="stat-value" id="statCompleted">—</div>
      </div>
    </div>
  </div>

  <!-- VIEW TOGGLE -->
  <div class="view-toggle">
    <button class="view-btn active" id="listViewBtn" onclick="switchView('list')">
      <i data-lucide="list"></i>
      List
    </button>
    <button class="view-btn" id="calViewBtn" onclick="switchView('calendar')">
      <i data-lucide="calendar-days"></i>
      Calendar
    </button>
  </div>

  <!-- LIST VIEW -->
  <div id="listView">
    <div class="filters">
      <button class="filter-btn active" onclick="setFilter('all', this)">All</button>
      <button class="filter-btn" onclick="setFilter('today', this)">Today</button>
      <button class="filter-btn" onclick="setFilter('upcoming', this)">Upcoming</button>
      <button class="filter-btn" onclick="setFilter('past', this)">Past</button>
      <button class="filter-btn" onclick="setFilter('cancelled', this)">Cancelled</button>
      <div class="search-wrap">
        <i data-lucide="search"></i>
        <input class="filter-search" type="text" placeholder="Search address or reference…" id="searchInput" oninput="renderBookings()">
      </div>
    </div>
    <div id="bookingsContainer">
      <div class="state-box">
        <div class="spinner"></div>
        <p>Loading your bookings…</p>
      </div>
    </div>
  </div>

  <!-- CALENDAR VIEW -->
  <div id="calendarView">

    <!-- Colour legend — visible on mobile only -->
    <div class="cal-legend">
      <div class="cal-legend-item"><div class="cal-legend-dot" style="background:#dbeafe;border:1px solid #93c5fd;"></div>Today</div>
      <div class="cal-legend-item"><div class="cal-legend-dot" style="background:#dcfce7;border:1px solid #86efac;"></div>Upcoming</div>
      <div class="cal-legend-item"><div class="cal-legend-dot" style="background:#f1f5f9;border:1px solid #cbd5e1;"></div>Past</div>
      <div class="cal-legend-item"><div class="cal-legend-dot" style="background:#fef2f2;border:1px solid #fca5a5;"></div>Cancelled</div>
    </div>

    <div class="cal-controls">
      <div class="cal-nav">
        <button class="cal-nav-btn" onclick="calPrev()"><i data-lucide="chevron-left"></i></button>
        <div class="cal-month-label" id="calMonthLabel">—</div>
        <button class="cal-nav-btn" onclick="calNext()"><i data-lucide="chevron-right"></i></button>
      </div>
      <button class="cal-today-btn" onclick="calGoToday()">Today</button>
    </div>
    <div class="cal-grid">
      <div class="cal-header-row">
        <div class="cal-header-cell">Mon</div>
        <div class="cal-header-cell">Tue</div>
        <div class="cal-header-cell">Wed</div>
        <div class="cal-header-cell">Thu</div>
        <div class="cal-header-cell">Fri</div>
        <div class="cal-header-cell">Sat</div>
        <div class="cal-header-cell">Sun</div>
      </div>
      <div class="cal-body" id="calBody"></div>
    </div>
  </div>

</main>

<!-- BOOKING DETAIL OVERLAY (calendar) -->
<div class="cal-detail-overlay" id="calDetailOverlay" onclick="closeCalDetail(event)">
  <div class="cal-detail-panel" id="calDetailPanel">
    <div class="cal-detail-header">
      <div>
        <h3 id="calDetailTitle">Booking Details</h3>
        <p id="calDetailSubtitle"></p>
      </div>
      <button class="cal-detail-close" onclick="closeCalDetailDirect()">
        <i data-lucide="x"></i>
      </button>
    </div>
    <div class="cal-detail-body" id="calDetailBody"></div>
  </div>
</div>

<script>
  let allBookings = [];
  let currentFilter = 'all';
  let currentView = 'list';
  let calDate = new Date();

  // ===== SHARED HELPERS =====

  function getBookingStatus(booking) {
    if (booking.bookingStatus === 'Cancelled') return 'cancelled';
    const today = new Date().toISOString().split('T')[0];
    if (booking.date === today) return 'today';
    if (booking.date > today) return 'upcoming';
    return 'past';
  }

  function formatDate(dateStr) {
    const d = new Date(dateStr + 'T12:00:00');
    return d.toLocaleDateString('en-GB', { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' });
  }

  function formatDateShort(dateStr) {
    const d = new Date(dateStr + 'T12:00:00');
    return d.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
  }

  function getInitials(name) {
    return (name || '').split(' ').map(w => w[0]).join('').toUpperCase().slice(0, 2);
  }

  function getAccessInfo(booking) {
    if (!booking.accessType) return null;
    if (booking.accessType === 'Meeting Agent') return { label: 'Meeting Agent at Property', detail: null, icon: 'users' };
    if (booking.accessType === 'Meeting Vendor') return { label: 'Meeting Vendor at Property', detail: null, icon: 'users' };
    if (booking.accessType === 'Pick Up Keys') return { label: 'Pick Up Keys', detail: booking.keyPickupLocation || 'Location TBC', icon: 'key' };
    return null;
  }

  function getSpecialistName() {
    try {
      const user = JSON.parse(localStorage.getItem('user') || '{}');
      if (user.name) return user.name;
    } catch(e) {}
    const params = new URLSearchParams(window.location.search);
    if (params.get('specialist')) return params.get('specialist');
    return null;
  }

  function handleLogout() {
    localStorage.removeItem('user');
    window.location.href = '/specialist-login';
  }

  // ===== LOAD DATA =====

  async function loadBookings() {
    const specialistName = getSpecialistName();
    if (!specialistName) {
      window.location.href = '/specialist-login';
      return;
    }

    document.getElementById('navName').textContent = specialistName;
    document.getElementById('navAvatar').textContent = getInitials(specialistName);

    try {
      const res = await fetch(`/.netlify/functions/get-specialist-bookings?specialist=${encodeURIComponent(specialistName)}`);
      if (!res.ok) throw new Error('Failed to load bookings');
      const data = await res.json();
      allBookings = data.bookings || [];
      updateStats();
      renderBookings();
      renderCalendar();
      lucide.createIcons();
    } catch (err) {
      document.getElementById('bookingsContainer').innerHTML = `
        <div class="state-box">
          <i data-lucide="alert-triangle"></i>
          <h3>Couldn't load bookings</h3>
          <p>${err.message}</p>
        </div>`;
      lucide.createIcons();
    }
  }

  // ===== STATS =====

  function updateStats() {
    document.getElementById('statToday').textContent = allBookings.filter(b => getBookingStatus(b) === 'today').length;
    document.getElementById('statUpcoming').textContent = allBookings.filter(b => getBookingStatus(b) === 'upcoming').length;
    document.getElementById('statCompleted').textContent = allBookings.filter(b => getBookingStatus(b) === 'past').length;
  }

  // ===== VIEW SWITCHING =====

  function switchView(view) {
    currentView = view;
    document.getElementById('listView').style.display = view === 'list' ? 'block' : 'none';
    document.getElementById('calendarView').style.display = view === 'calendar' ? 'block' : 'none';
    document.getElementById('listViewBtn').classList.toggle('active', view === 'list');
    document.getElementById('calViewBtn').classList.toggle('active', view === 'calendar');
    if (view === 'calendar') {
      renderCalendar();
    }
    lucide.createIcons();
  }

  // ===== LIST VIEW =====

  function setFilter(filter, btn) {
    currentFilter = filter;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderBookings();
  }

  function renderBookings() {
    const search = document.getElementById('searchInput').value.toLowerCase();

    let bookings = allBookings.filter(b => {
      const status = getBookingStatus(b);
      if (currentFilter !== 'all' && status !== currentFilter) return false;
      if (search) {
        const haystack = `${b.propertyAddress} ${b.postcode} ${b.bookingRef} ${b.clientName} ${b.service}`.toLowerCase();
        if (!haystack.includes(search)) return false;
      }
      return true;
    });

    bookings.sort((a, b) => {
      const sa = getBookingStatus(a), sb = getBookingStatus(b);
      const order = { today: 0, upcoming: 1, past: 2, cancelled: 3 };
      if (order[sa] !== order[sb]) return order[sa] - order[sb];
      if (sa === 'past') return b.date.localeCompare(a.date);
      return a.date.localeCompare(b.date);
    });

    if (bookings.length === 0) {
      document.getElementById('bookingsContainer').innerHTML = `
        <div class="state-box">
          <i data-lucide="inbox"></i>
          <h3>No bookings found</h3>
          <p>Try a different filter or search term.</p>
        </div>`;
      lucide.createIcons();
      return;
    }

    let html = '';
    if (currentFilter === 'all' && !search) {
      const groups = [
        { key: 'today', label: "Today's Shoots" },
        { key: 'upcoming', label: 'Upcoming' },
        { key: 'past', label: 'Past' },
        { key: 'cancelled', label: 'Cancelled' }
      ];
      groups.forEach(({ key, label }) => {
        const group = bookings.filter(b => getBookingStatus(b) === key);
        if (group.length === 0) return;
        html += `<div class="section-label">${label}</div>`;
        group.forEach(b => { html += buildCard(b); });
      });
    } else {
      bookings.forEach(b => { html += buildCard(b); });
    }

    document.getElementById('bookingsContainer').innerHTML = `<div class="bookings-list">${html}</div>`;
    lucide.createIcons();
  }

  function buildCard(booking) {
    const status = getBookingStatus(booking);
    const access = getAccessInfo(booking);

    let addons = [];
    try { addons = typeof booking.addons === 'string' ? JSON.parse(booking.addons) : (booking.addons || []); } catch(e) {}

    const badgeMap = {
      today: '<span class="booking-badge badge-today">Today</span>',
      upcoming: '<span class="booking-badge badge-upcoming">Upcoming</span>',
      past: '<span class="booking-badge badge-past">Completed</span>',
      cancelled: '<span class="booking-badge badge-cancelled">Cancelled</span>'
    };

    const dotClass = { today: 'status-today', upcoming: 'status-upcoming', past: 'status-past', cancelled: 'status-cancelled' }[status];

    const accessHtml = access ? `
      <div class="access-alert">
        <i data-lucide="${access.icon}"></i>
        <div>
          <strong>${access.label}</strong>
          ${access.detail ? `<span>${access.detail}</span>` : ''}
        </div>
      </div>` : '';

    const addonsHtml = addons.length > 0 ? `
      <div class="detail-item full">
        <div class="detail-label"><i data-lucide="plus-circle"></i> Add-ons</div>
        <div class="addons-list">${addons.map(a => `<span class="addon-tag">${a.name || a}</span>`).join('')}</div>
      </div>` : '';

    const notesHtml = booking.clientNotes ? `
      <div class="detail-item full">
        <div class="detail-label"><i data-lucide="message-square"></i> Client Notes</div>
        <div class="notes-box">${booking.clientNotes}</div>
      </div>` : '';

    const duration = booking.duration
      ? Math.floor(booking.duration / 60) + 'h' + (booking.duration % 60 ? ' ' + (booking.duration % 60) + 'm' : '')
      : '—';

    return `
      <div class="booking-card ${status === 'today' ? 'today-card' : ''}" onclick="toggleCard(this)">
        <div class="booking-card-header">
          <div class="booking-status-dot ${dotClass}"></div>
          <div class="booking-main">
            <div class="booking-ref">${booking.bookingRef}</div>
            <div class="booking-address">${booking.propertyAddress}${booking.postcode ? ', ' + booking.postcode : ''}</div>
            <div class="booking-service">${booking.service}${addons.length > 0 ? ` + ${addons.length} add-on${addons.length > 1 ? 's' : ''}` : ''}</div>
          </div>
          <div class="booking-meta">
            ${badgeMap[status]}
            <div class="booking-date">${formatDateShort(booking.date)}</div>
            <div class="booking-time">${booking.time}</div>
          </div>
          <div class="booking-chevron"><i data-lucide="chevron-down"></i></div>
        </div>
        <div class="booking-details">
          ${accessHtml}
          <div class="details-grid">
            <div class="detail-item">
              <div class="detail-label"><i data-lucide="calendar"></i> Date & Time</div>
              <div class="detail-value">${formatDate(booking.date)} at ${booking.time}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label"><i data-lucide="user"></i> Client Name</div>
              <div class="detail-value">${booking.clientName}</div>
            </div>
            <div class="detail-item full">
              <div class="detail-label"><i data-lucide="map-pin"></i> Property Address</div>
              <div class="detail-value">${booking.propertyAddress}${booking.postcode ? ', ' + booking.postcode : ''}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label"><i data-lucide="camera"></i> Service</div>
              <div class="detail-value">${booking.service}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label"><i data-lucide="home"></i> Bedrooms</div>
              <div class="detail-value">${booking.bedrooms || '—'}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label"><i data-lucide="phone"></i> Client Phone</div>
              <div class="detail-value">${booking.clientPhone ? `<a href="tel:${booking.clientPhone}" style="color:var(--blue);text-decoration:none">${booking.clientPhone}</a>` : '—'}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label"><i data-lucide="clock"></i> Duration</div>
              <div class="detail-value">${duration}</div>
            </div>
            ${addonsHtml}
            ${notesHtml}
          </div>
        </div>
      </div>`;
  }

  function toggleCard(card) {
    card.classList.toggle('expanded');
    lucide.createIcons();
  }

  // ===== CALENDAR VIEW =====

  function calPrev() {
    calDate = new Date(calDate.getFullYear(), calDate.getMonth() - 1, 1);
    renderCalendar();
  }

  function calNext() {
    calDate = new Date(calDate.getFullYear(), calDate.getMonth() + 1, 1);
    renderCalendar();
  }

  function calGoToday() {
    calDate = new Date();
    renderCalendar();
  }

  function renderCalendar() {
    const year = calDate.getFullYear();
    const month = calDate.getMonth();

    document.getElementById('calMonthLabel').textContent =
      new Date(year, month, 1).toLocaleDateString('en-GB', { month: 'long', year: 'numeric' });

    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const todayStr = new Date().toISOString().split('T')[0];

    // Monday-start: 0=Mon … 6=Sun
    let startDow = firstDay.getDay(); // 0=Sun
    startDow = startDow === 0 ? 6 : startDow - 1; // convert to Mon-start

    // Build map: dateStr -> bookings[]
    const bookingMap = {};
    allBookings.forEach(b => {
      if (!bookingMap[b.date]) bookingMap[b.date] = [];
      bookingMap[b.date].push(b);
    });

    let cells = '';

    // Leading blanks
    for (let i = 0; i < startDow; i++) {
      const d = new Date(year, month, 1 - (startDow - i));
      const ds = d.toISOString().split('T')[0];
      cells += buildCalCell(ds, true, todayStr, bookingMap[ds] || []);
    }

    // Current month days
    for (let d = 1; d <= lastDay.getDate(); d++) {
      const ds = `${year}-${String(month + 1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      cells += buildCalCell(ds, false, todayStr, bookingMap[ds] || []);
    }

    // Trailing blanks to fill grid
    const totalCells = startDow + lastDay.getDate();
    const remainder = totalCells % 7 === 0 ? 0 : 7 - (totalCells % 7);
    for (let i = 1; i <= remainder; i++) {
      const d = new Date(year, month + 1, i);
      const ds = d.toISOString().split('T')[0];
      cells += buildCalCell(ds, true, todayStr, bookingMap[ds] || []);
    }

    document.getElementById('calBody').innerHTML = cells;
    lucide.createIcons();
  }

  function buildCalCell(dateStr, otherMonth, todayStr, bookings) {
    const dayNum = parseInt(dateStr.split('-')[2]);
    const isToday = dateStr === todayStr;
    const hasBookings = bookings.length > 0;

    let classes = 'cal-cell';
    if (otherMonth) classes += ' other-month';
    if (isToday) classes += ' is-today';
    if (hasBookings) classes += ' has-bookings';

    const MAX_SHOW = 3;
    const visible = bookings.slice(0, MAX_SHOW);
    const extra = bookings.length - MAX_SHOW;

    const eventsHtml = visible.map(b => {
      const status = getBookingStatus(b);
      const evClass = { today: 'ev-today', upcoming: 'ev-upcoming', past: 'ev-past', cancelled: 'ev-cancelled' }[status];
      const safeB = encodeBookingForAttr(b);
      return `<div class="cal-event ${evClass}" onclick="event.stopPropagation(); openCalDetail(${safeB})">${b.time} ${b.clientName || b.propertyAddress}</div>`;
    }).join('');

    const moreHtml = extra > 0
      ? `<div class="cal-more">+${extra} more</div>`
      : '';

    return `<div class="${classes}">\
<div class="cal-day-num">${dayNum}</div>\
${eventsHtml}${moreHtml}\
</div>`;
  }

  function encodeBookingForAttr(b) {
    // Pass as JSON string to inline onclick safely
    return "'" + JSON.stringify(b).replace(/'/g, '&#39;') + "'";
  }

  function openCalDetail(bookingOrStr) {
    const booking = typeof bookingOrStr === 'string' ? JSON.parse(bookingOrStr) : bookingOrStr;
    const status = getBookingStatus(booking);

    let addons = [];
    try { addons = typeof booking.addons === 'string' ? JSON.parse(booking.addons) : (booking.addons || []); } catch(e) {}

    const access = getAccessInfo(booking);
    const duration = booking.duration
      ? Math.floor(booking.duration / 60) + 'h' + (booking.duration % 60 ? ' ' + (booking.duration % 60) + 'm' : '')
      : '—';

    const badgeMap = {
      today: '<span class="booking-badge badge-today">Today</span>',
      upcoming: '<span class="booking-badge badge-upcoming">Upcoming</span>',
      past: '<span class="booking-badge badge-past">Completed</span>',
      cancelled: '<span class="booking-badge badge-cancelled">Cancelled</span>'
    };

    document.getElementById('calDetailTitle').textContent = booking.propertyAddress + (booking.postcode ? ', ' + booking.postcode : '');
    document.getElementById('calDetailSubtitle').textContent = formatDate(booking.date) + ' · ' + booking.time;

    const accessHtml = access ? `
      <div class="access-alert" style="margin-bottom:16px;">
        <i data-lucide="${access.icon}"></i>
        <div>
          <strong>${access.label}</strong>
          ${access.detail ? `<span>${access.detail}</span>` : ''}
        </div>
      </div>` : '';

    const addonsHtml = addons.length > 0 ? `
      <div class="detail-item full" style="margin-top:4px;">
        <div class="detail-label"><i data-lucide="plus-circle"></i> Add-ons</div>
        <div class="addons-list">${addons.map(a => `<span class="addon-tag">${a.name || a}</span>`).join('')}</div>
      </div>` : '';

    const notesHtml = booking.clientNotes ? `
      <div class="detail-item full" style="margin-top:4px;">
        <div class="detail-label"><i data-lucide="message-square"></i> Client Notes</div>
        <div class="notes-box">${booking.clientNotes}</div>
      </div>` : '';

    document.getElementById('calDetailBody').innerHTML = `
      ${accessHtml}
      <div style="margin-bottom:16px;">${badgeMap[status]}</div>
      <div class="cal-detail-grid">
        <div class="detail-item">
          <div class="detail-label"><i data-lucide="hash"></i> Reference</div>
          <div class="detail-value" style="font-family:'DM Mono',monospace;font-size:13px;">${booking.bookingRef}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label"><i data-lucide="clock"></i> Duration</div>
          <div class="detail-value">${duration}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label"><i data-lucide="user"></i> Client</div>
          <div class="detail-value">${booking.clientName}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label"><i data-lucide="phone"></i> Phone</div>
          <div class="detail-value">${booking.clientPhone ? `<a href="tel:${booking.clientPhone}" style="color:var(--blue);text-decoration:none">${booking.clientPhone}</a>` : '—'}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label"><i data-lucide="camera"></i> Service</div>
          <div class="detail-value">${booking.service}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label"><i data-lucide="home"></i> Bedrooms</div>
          <div class="detail-value">${booking.bedrooms || '—'}</div>
        </div>
        <div class="detail-item full">
          <div class="detail-label"><i data-lucide="map-pin"></i> Address</div>
          <div class="detail-value">${booking.propertyAddress}${booking.postcode ? ', ' + booking.postcode : ''}</div>
        </div>
        ${addonsHtml}
        ${notesHtml}
      </div>
    `;

    document.getElementById('calDetailOverlay').classList.add('open');
    lucide.createIcons();
  }

  function closeCalDetail(e) {
    if (e.target === document.getElementById('calDetailOverlay')) {
      closeCalDetailDirect();
    }
  }

  function closeCalDetailDirect() {
    document.getElementById('calDetailOverlay').classList.remove('open');
  }

  loadBookings();
</script>
</body>
</html>