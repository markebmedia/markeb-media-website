<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Property Marketing Audit | Markeb Media</title>
    <meta name="description" content="Discover where you're losing listings and revenue. Get your personalised property marketing analysis in 2 minutes.">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="../public/images/Markeb Media Logo (2).PNG">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', 'Segoe UI', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #1F2E3C;
            background: #F9FAFB;
        }

        html {
            scroll-behavior: smooth;
        }

        /* Audit Section */
        .audit-section {
            padding: 60px 20px 80px;
            min-height: 100vh;
        }

        .audit-container {
            max-width: 800px;
            margin: 0 auto;
            background: #FFFFFF;
            border-radius: 24px;
            padding: 50px 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            border: 2px solid #F1F5F9;
        }

        .audit-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .audit-badge {
            display: inline-block;
            background: linear-gradient(135deg, #FF6B00, #FF8A33);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 20px;
        }

        .audit-header h1 {
            font-size: 2.4em;
            font-weight: 800;
            color: #1F2E3C;
            margin-bottom: 15px;
            line-height: 1.2;
        }

        .audit-header p {
            font-size: 1.2em;
            color: #6B7280;
            margin-bottom: 10px;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: #E5E7EB;
            border-radius: 10px;
            overflow: hidden;
            margin: 30px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF6B00, #FF8A33);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .progress-text {
            text-align: center;
            color: #6B7280;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-card {
            background: #F9FAFB;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid #E5E7EB;
        }

        .question-number {
            display: inline-block;
            background: linear-gradient(135deg, #FF6B00, #FF8A33);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.3em;
            font-weight: 700;
            color: #1F2E3C;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 18px 20px;
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .option-label:hover {
            border-color: #FF6B00;
            background: #FFF5F0;
            transform: translateX(5px);
        }

        .option-label input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .option-label input[type="radio"]:checked + .checkmark {
            background: #FF6B00;
            border-color: #FF6B00;
        }

        .option-label input[type="radio"]:checked + .checkmark::after {
            display: block;
        }

        .option-label.selected {
            border-color: #FF6B00;
            background: linear-gradient(135deg, #FFF5F0 0%, #FFEDE0 100%);
            box-shadow: 0 4px 15px rgba(255, 107, 0, 0.15);
        }

        .checkmark {
            width: 24px;
            height: 24px;
            border: 2px solid #D1D5DB;
            border-radius: 50%;
            margin-right: 15px;
            position: relative;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .checkmark::after {
            content: '‚úì';
            position: absolute;
            display: none;
            color: white;
            font-size: 14px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .option-text {
            flex: 1;
            font-size: 1.05em;
            color: #374151;
            line-height: 1.5;
        }

        .form-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.05em;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            margin-bottom: 15px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #FF6B00;
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
        }

        .form-input::placeholder {
            color: #9CA3AF;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FF6B00, #FF8A33);
            color: white;
            box-shadow: 0 6px 20px rgba(255, 107, 0, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 0, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: white;
            color: #6B7280;
            border: 2px solid #E5E7EB;
        }

        .btn-secondary:hover {
            background: #F9FAFB;
            border-color: #D1D5DB;
        }

        .results-container {
            display: none;
        }

        .results-container.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .score-display {
            background: linear-gradient(135deg, #FF6B00, #FF8A33);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(255, 107, 0, 0.3);
            text-align: center;
        }

        .score-number {
            font-size: 4em;
            font-weight: 900;
            margin-bottom: 10px;
        }

        .score-verdict {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .score-description {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .analysis-content {
            background: #F9FAFB;
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            text-align: left;
            border: 2px solid #E5E7EB;
        }

        .analysis-content h3 {
            color: #1F2E3C;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .analysis-content h3:first-child {
            margin-top: 0;
        }

        .analysis-content p, .analysis-content ul {
            color: #4A6378;
            font-size: 1.05em;
            line-height: 1.7;
            margin-bottom: 15px;
        }

        .analysis-content ul {
            padding-left: 20px;
        }

        .analysis-content li {
            margin-bottom: 10px;
        }

        .cta-button {
            display: inline-block;
            padding: 16px 36px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #FF6B00, #FF8A33);
            color: #fff;
            text-decoration: none;
            border-radius: 14px;
            font-weight: 900;
            box-shadow: 0 6px 16px rgba(255,107,0,0.25);
            transition: transform .15s ease;
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255,107,0,0.35);
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading-spinner.active {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #E5E7EB;
            border-top: 4px solid #FF6B00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            display: none;
            background: #FEE2E2;
            border: 2px solid #FCA5A5;
            color: #991B1B;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .error-message.active {
            display: block;
        }

        .success-message {
            display: none;
            background: #D1FAE5;
            border: 2px solid #6EE7B7;
            color: #065F46;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .success-message.active {
            display: block;
        }

        .success-message p {
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .success-message .email-note {
            font-size: 0.95em;
            opacity: 0.9;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .audit-section {
                padding: 40px 15px 60px;
            }

            .audit-container {
                padding: 30px 20px;
            }
            
            .audit-header h1 {
                font-size: 1.8em;
            }
            
            .question-text {
                font-size: 1.15em;
            }
            
            .option-label {
                padding: 15px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }

            .score-number {
                font-size: 3em;
            }
        }
    </style>
</head>
<body>
    <!-- Audit Section -->
    <section class="audit-section">
        <div class="audit-container">
            <div class="audit-header">
                <div class="audit-badge">üéØ Free Marketing Audit</div>
                <h1>How Effective Is Your Property Marketing?</h1>
                <p>Answer 8 quick questions to discover where you're losing listings and revenue.</p>
            </div>

            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="progress-text" id="progressText">Question 1 of 8</div>

            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage">
                <p>‚úÖ Thank you! Your audit has been submitted successfully.</p>
                <p class="email-note">üìß Check your email for your personalised marketing analysis and recommendations.</p>
            </div>

            <form id="auditForm">
                <!-- Question 1 -->
                <div class="form-step active" data-step="1">
                    <div class="question-card">
                        <div class="question-number">1</div>
                        <div class="question-text">What type of photography do you currently use for property listings?</div>
                        <div class="option-group">
                            <label class="option-label">
                                <input type="radio" name="q1" value="1" required>
                                <div class="checkmark"></div>
                                <span class="option-text">iPhone or basic camera photos</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q1" value="2">
                                <div class="checkmark"></div>
                                <span class="option-text">General mediaspecialist (does properties occasionally)</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q1" value="3">
                                <div class="checkmark"></div>
                                <span class="option-text">Specialist property mediaspecialist with HDR/editing</span>
                            </label>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn btn-primary" onclick="nextStep()" style="width: 100%;">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Question 2 -->
                <div class="form-step" data-step="2">
                    <div class="question-card">
                        <div class="question-number">2</div>
                        <div class="question-text">Do you currently use video content for your listings?</div>
                        <div class="option-group">
                            <label class="option-label">
                                <input type="radio" name="q2" value="0" required>
                                <div class="checkmark"></div>
                                <span class="option-text">No video content at all</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q2" value="2">
                                <div class="checkmark"></div>
                                <span class="option-text">Basic walkthrough videos occasionally</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q2" value="4">
                                <div class="checkmark"></div>
                                <span class="option-text">Professional video tours for most/all listings</span>
                            </label>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Question 3 -->
                <div class="form-step" data-step="3">
                    <div class="question-card">
                        <div class="question-number">3</div>
                        <div class="question-text">How often do you use drone/aerial footage?</div>
                        <div class="option-group">
                            <label class="option-label">
                                <input type="radio" name="q3" value="0" required>
                                <div class="checkmark"></div>
                                <span class="option-text">Never - don't use drone footage</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q3" value="2">
                                <div class="checkmark"></div>
                                <span class="option-text">Occasionally for premium properties</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q3" value="3">
                                <div class="checkmark"></div>
                                <span class="option-text">Regularly use aerial shots when appropriate</span>
                            </label>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Question 4 -->
                <div class="form-step" data-step="4">
                    <div class="question-card">
                        <div class="question-number">4</div>
                        <div class="question-text">What's your typical turnaround time from shoot to receiving media?</div>
                        <div class="option-group">
                            <label class="option-label">
                                <input type="radio" name="q4" value="1" required>
                                <div class="checkmark"></div>
                                <span class="option-text">1 week or more</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q4" value="2">
                                <div class="checkmark"></div>
                                <span class="option-text">3-5 business days</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q4" value="3">
                                <div class="checkmark"></div>
                                <span class="option-text">48 hours or less</span>
                            </label>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Question 5 -->
                <div class="form-step" data-step="5">
                    <div class="question-card">
                        <div class="question-number">5</div>
                        <div class="question-text">How active are you on social media with property content?</div>
                        <div class="option-group">
                            <label class="option-label">
                                <input type="radio" name="q5" value="1" required>
                                <div class="checkmark"></div>
                                <span class="option-text">Rarely or never post property content</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q5" value="2">
                                <div class="checkmark"></div>
                                <span class="option-text">Occasionally share new listings</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q5" value="3">
                                <div class="checkmark"></div>
                                <span class="option-text">Regular, engaging content strategy</span>
                            </label>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Question 6 -->
                <div class="form-step" data-step="6">
                    <div class="question-card">
                        <div class="question-number">6</div>
                        <div class="question-text">Do you provide clients with regular marketing performance reports?</div>
                        <div class="option-group">
                            <label class="option-label">
                                <input type="radio" name="q6" value="0" required>
                                <div class="checkmark"></div>
                                <span class="option-text">No - clients rarely receive performance updates</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q6" value="1">
                                <div class="checkmark"></div>
                                <span class="option-text">Occasional updates when clients ask</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q6" value="3">
                                <div class="checkmark"></div>
                                <span class="option-text">Weekly performance reports with views, engagement & enquiries</span>
                            </label>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Question 7 -->
                <div class="form-step" data-step="7">
                    <div class="question-card">
                        <div class="question-number">7</div>
                        <div class="question-text">How do vendors typically react to your property marketing materials?</div>
                        <div class="option-group">
                            <label class="option-label">
                                <input type="radio" name="q7" value="1" required>
                                <div class="checkmark"></div>
                                <span class="option-text">Often disappointed or request improvements</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q7" value="2">
                                <div class="checkmark"></div>
                                <span class="option-text">Generally satisfied, no major complaints</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q7" value="3">
                                <div class="checkmark"></div>
                                <span class="option-text">Consistently impressed and share with friends</span>
                            </label>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Question 8 -->
                <div class="form-step" data-step="8">
                    <div class="question-card">
                        <div class="question-number">8</div>
                        <div class="question-text">How does your marketing compare to competitors in your area?</div>
                        <div class="option-group">
                            <label class="option-label">
                                <input type="radio" name="q8" value="1" required>
                                <div class="checkmark"></div>
                                <span class="option-text">We're behind - competitors have better visuals</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q8" value="2">
                                <div class="checkmark"></div>
                                <span class="option-text">About the same - similar quality</span>
                            </label>
                            <label class="option-label">
                                <input type="radio" name="q8" value="3">
                                <div class="checkmark"></div>
                                <span class="option-text">We're the market leader in presentation</span>
                            </label>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()">Next ‚Üí</button>
                    </div>
                </div>

                <!-- Step 9: Contact Info -->
                <div class="form-step" data-step="9">
                    <div class="question-card">
                        <div class="question-text" style="font-size: 1.5em; margin-bottom: 15px;">üìä Your Score is Ready!</div>
                        <p style="color: #6B7280; font-size: 1.1em; margin-bottom: 25px;">Enter your details below to receive your personalised marketing analysis and actionable recommendations via email.</p>
                        <input type="text" class="form-input" id="name" placeholder="Your Full Name *" required>
                        <input type="text" class="form-input" id="agency" placeholder="Agency Name *" required>
                        <input type="email" class="form-input" id="email" placeholder="Email Address *" required>
                        <input type="tel" class="form-input" id="phone" placeholder="Phone Number *" required>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
                        <button type="button" class="btn btn-primary" onclick="submitAudit()">Get My Full Analysis ‚Üí</button>
                    </div>
                </div>
            </form>

            <!-- Loading State -->
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
                <p style="color: #6B7280; font-size: 1.1em;">Analysing your marketing strategy...</p>
            </div>

            <!-- Results -->
            <div class="results-container" id="resultsContainer">
                <div class="score-display" id="scoreDisplay">
                    <div class="score-number" id="scoreNumber"></div>
                    <div class="score-verdict" id="scoreVerdict"></div>
                    <div class="score-description" id="scoreDescription"></div>
                </div>

                <div class="analysis-content" id="analysisContent"></div>

                <div style="text-align: center; margin-top: 40px;">
                    <a href="login.html" class="cta-button">
                        Book Your Premium Shoot Now
                    </a>
                </div>
            </div>
        </div>
    </section>

    <script>
let currentStep = 1;
const totalSteps = 8;
const formData = {};

function updateProgress() {
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const progress = Math.min((currentStep / totalSteps) * 100, 100);
    progressBar.style.width = progress + '%';
    if (currentStep <= totalSteps) {
        progressText.style.display = 'block';
        progressText.textContent = `Question ${currentStep} of ${totalSteps}`;
    } else {
        progressText.style.display = 'none';
    }
}

function nextStep() {
    const steps = document.querySelectorAll('.form-step');
    const currentStepElement = steps[currentStep - 1];

    if (currentStep === 9) {
        const name = document.getElementById('name').value.trim();
        const agency = document.getElementById('agency').value.trim();
        const email = document.getElementById('email').value.trim();
        const phone = document.getElementById('phone').value.trim();

        if (!name || !agency || !email || !phone) {
            showError('Please fill in all required fields');
            return;
        }

        formData.name = name;
        formData.agency = agency;
        formData.email = email;
        formData.phone = phone;
    } else {
        const questionName = `q${currentStep}`;
        const selected = document.querySelector(`input[name="${questionName}"]:checked`);
        
        if (!selected) {
            showError('Please select an answer to continue');
            return;
        }

        formData[questionName] = parseInt(selected.value);
    }

    hideError();
    currentStepElement.classList.remove('active');
    currentStep++;
    
    if (currentStep <= 9) {
        steps[currentStep - 1].classList.add('active');
        updateProgress();
    }
}

function prevStep() {
    const steps = document.querySelectorAll('.form-step');
    steps[currentStep - 1].classList.remove('active');
    currentStep--;
    steps[currentStep - 1].classList.add('active');
    updateProgress();
    hideError();
}

function showError(message) {
    const errorEl = document.getElementById('errorMessage');
    errorEl.textContent = message;
    errorEl.classList.add('active');
    setTimeout(() => errorEl.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
}

function hideError() {
    document.getElementById('errorMessage').classList.remove('active');
}

function showSuccess() {
    const successEl = document.getElementById('successMessage');
    successEl.classList.add('active');
    setTimeout(() => successEl.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
}

function calculateScore() {
    return (formData.q1 || 0) + (formData.q2 || 0) + (formData.q3 || 0) + 
           (formData.q4 || 0) + (formData.q5 || 0) + (formData.q6 || 0) + 
           (formData.q7 || 0) + (formData.q8 || 0);
}

function getVerdict(score) {
    if (score <= 10) return { text: 'Needs Improvement', colour: '#DC2626', desc: 'Your marketing needs urgent attention' };
    if (score <= 16) return { text: 'Fair', colour: '#F59E0B', desc: 'Room for significant improvement' };
    if (score <= 21) return { text: 'Good', colour: '#10B981', desc: 'Strong foundation with growth potential' };
    return { text: 'Excellent', colour: '#059669', desc: 'Industry-leading marketing approach' };
}

function mapAnswersToKeys(formData) {
    return {
        professionalContent: formData.q1 >= 3 ? 'yes' : 'no',
        videoContent: formData.q2 >= 2 ? 'yes' : 'no',
        droneContent: formData.q3 >= 2 ? 'yes' : 'no',
        quickTurnaround: formData.q4 >= 3 ? 'yes' : 'no',
        socialMedia: formData.q5 >= 2 ? 'yes' : 'inconsistent',
        trackResults: formData.q6 >= 1 ? 'yes' : 'no',
        clientSatisfaction: formData.q7 >= 2 ? 'yes' : 'no',
        competitivePosition: formData.q8 >= 2 ? 'yes' : 'no',
        personalBranding: formData.q1 >= 3 && formData.q2 >= 2 ? 'yes' : 'no',
        contentConsistency: formData.q5 >= 2 ? 'yes' : 'no',
        timeForMarketing: formData.q4 >= 2 ? 'yes' : 'no',
        contentManagement: formData.q6 >= 1 ? 'yes' : 'no',
        outsourceMarketing: formData.q1 <= 2 || formData.q2 <= 2 ? 'no' : 'yes'
    };
}

async function submitAudit() {
    const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;

    const nameInput = document.getElementById('name');
    const agencyInput = document.getElementById('agency');
    const emailInput = document.getElementById('email');
    const phoneInput = document.getElementById('phone');

    if (!nameInput || !agencyInput || !emailInput || !phoneInput) {
        showError('Something went wrong. Please refresh and try again.');
        return;
    }

    const name = nameInput.value.trim();
    const agency = agencyInput.value.trim();
    const email = emailInput.value.trim();
    const phone = phoneInput.value.trim();

    if (!name || !agency || !email || !phone) {
        showError('Please fill in all required contact details.');
        return;
    }

    const score = calculateScore();
    const mappedAnswers = mapAnswersToKeys(formData);
    
    // Prepare raw answers for Airtable function
    const rawAnswers = {
        q1: formData.q1,
        q2: formData.q2,
        q3: formData.q3,
        q4: formData.q4,
        q5: formData.q5,
        q6: formData.q6,
        q7: formData.q7,
        q8: formData.q8
    };

    document.getElementById('auditForm').style.display = 'none';
    document.getElementById('loadingSpinner').classList.add('active');
    hideError();
    window.scrollTo(0, scrollPosition);

    try {
        // Call BOTH functions in parallel
        const [emailResponse, airtableResponse] = await Promise.all([
            // 1. Send customer email
            fetch('/.netlify/functions/send-audit-results', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name: name,
                    email: email,
                    company: agency,
                    answers: mappedAnswers,
                    score: score
                })
            }),
            // 2. Save to Airtable & send internal notification
            fetch('/.netlify/functions/submit-audit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name: name,
                    agency: agency,
                    email: email,
                    phone: phone,
                    score: score,
                    answers: rawAnswers
                })
            })
        ]);

        const emailData = await emailResponse.json();
        const airtableData = await airtableResponse.json();

        if (!emailResponse.ok) {
            throw new Error(emailData.error || 'Failed to send email');
        }

        if (!airtableResponse.ok) {
            console.warn('Airtable submission failed:', airtableData.error);
            // Don't throw error - customer still gets their email
        }

        // Hide loading, show success message
        document.getElementById('loadingSpinner').classList.remove('active');
        showSuccess();

        // Show brief results on page
        setTimeout(() => {
            showResults(score, `Your detailed analysis has been sent to ${email}`);
        }, 2000);

    } catch (error) {
        console.error('Error submitting audit:', error);
        document.getElementById('loadingSpinner').classList.remove('active');
        document.getElementById('auditForm').style.display = 'block';
        window.scrollTo(0, scrollPosition);
        showError('Sorry, there was an error submitting your audit. Please try again or contact us at commercial@markebmedia.com');
    }
}

function showResults(score, message) {
    const verdict = getVerdict(score);
    
    document.getElementById('scoreNumber').textContent = score + '/25';
    document.getElementById('scoreVerdict').textContent = verdict.text;
    document.getElementById('scoreDescription').textContent = verdict.desc;
    
    document.getElementById('analysisContent').innerHTML = `
        <h3>üìß Check Your Email</h3>
        <p>${message}</p>
        <p>We've sent you a comprehensive analysis including:</p>
        <ul>
            <li>Detailed breakdown of your marketing strengths and weaknesses</li>
            <li>Personalised recommendations for improvement</li>
            <li>Priority action items to boost your property marketing</li>
            <li>How Markeb Media can help you achieve better results</li>
        </ul>
        <p><strong>Didn't receive the email?</strong> Check your spam folder or contact us at <a href="mailto:commercial@markebmedia.com">commercial@markebmedia.com</a></p>
    `;
    
    document.getElementById('resultsContainer').classList.add('active');
    
    setTimeout(() => {
        document.getElementById('resultsContainer').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
        });
    }, 100);
}

document.addEventListener('DOMContentLoaded', function() {
    const radioLabels = document.querySelectorAll('.option-label');
    radioLabels.forEach(label => {
        label.addEventListener('click', function() {
            const siblings = this.parentElement.querySelectorAll('.option-label');
            siblings.forEach(s => s.classList.remove('selected'));
            this.classList.add('selected');
        });
    });
    
    updateProgress();
});
</script>
</body>
</html>